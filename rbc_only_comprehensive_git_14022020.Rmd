---
title: "rbc_only_comprehensive_manuscript_14022020"
author: "Jesse Rop"
date: "December 5, 2019"
output:
  html_document:
    theme: default
    highlight: zenburn
    toc: true
    toc_depth: 3
    toc_float: false
  word_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r data_preprocessing, include=FALSE}










library(DescTools)
library(EnvStats)
library(ggplot2)
library(olsrr)
library(haven)
library(dplyr)
library(moments)
library(janitor)
library(HardyWeinberg)
library(lubridate)
library(data.table)
library(ggpubr)
library(digest)
library(colorspace)
library(ggforce)
library(rlang)
library(ggsignif)
library(knitr)
library(stargazer)
library(Rcpp)
library(glue)
library(magicfor)
library(xtable)
library(pander)
library(tab)
library(ISwR)
library(emmeans)
library(arsenal)
library(EnvStats)

rm(list = ls())
setwd("C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/pgd working directory/rbc only/")

##23082018 
##Reading the pgd file containing the pgd genotype and phenotype data and file with both 2010 and 2011 CBC data.
pgd_clean_genotypes_plus_phenotypes_23032018_raw_from_stata = read_dta("C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/CBC_2010_activity_final_15062015.dta")
pgd_clean_2010_2011_cbc_plus_other_phen = read_dta("C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/12062015/CBC_2010_2011_12062015_Activity_genotypes12062015.dta")

##010418
##Writing the files out as csv files
write.csv(pgd_clean_genotypes_plus_phenotypes_23032018_raw_from_stata, file = "C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/pgd working directory/pgd_clean_genotypes_plus_phenotypes_01_04_2018.csv", quote = F, row.names = F)
write.csv(pgd_clean_2010_2011_cbc_plus_other_phen, file = "C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/pgd working directory/pgd_clean_2010_2011_cbc_plus_other_phen.csv", quote = F, row.names = F)

##Reading the text file back into R for analysis
pgd_genopheno_01042018 = read.csv("C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/pgd working directory/pgd_clean_genotypes_plus_phenotypes_01_04_2018.csv", stringsAsFactors = F, na.strings = c("NA", "", ".", "<NA>"))
pgd_2010_2011_phen = read.csv("C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/pgd working directory/pgd_clean_2010_2011_cbc_plus_other_phen.csv", stringsAsFactors = F, na.strings = c("NA", "", ".", "<NA>"))

###Reading in new g6pd_202_rtpcr genotypes generated by rtpcr
g6pd_202_rtpcr = read.csv("C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/Regenotyping/Results/rtpcr_results.csv", stringsAsFactors = F, na.strings = c("NA", "", ".", "<NA>"))

##Merging the 2011 cbc data into the main file with other variables
pgd_genopheno_01042018 = merge(pgd_genopheno_01042018, pgd_2010_2011_phen[pgd_2010_2011_phen$year2 == "2011", c(44,4,5,11,13,15:30,37:40,43,45,46,49,80,64,65)], by.x = "serial", by.y = "serial", all = T, suffixes = c("_2010","_2011"))
pgd_genopheno_01042018 = pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018$serial), ]

##Removing the pgd_clean_genotypes_plus_phenotypes_23032018_raw_from_stata since it's of stata file format
remove(pgd_clean_genotypes_plus_phenotypes_23032018_raw_from_stata)

##Removing those with erronous enzyme activity readings
pgd_genopheno_01042018$u_ghb_raw =  pgd_genopheno_01042018[,"u_ghb"] / 1.488
pgd_genopheno_01042018$u_ghb = ifelse(is.na(pgd_genopheno_01042018[, "comments"]), pgd_genopheno_01042018[,"u_ghb_raw"], NA)
pgd_genopheno_01042018$u_ghb = ifelse(pgd_genopheno_01042018$u_ghb < 0 , 0 , pgd_genopheno_01042018$u_ghb)
pgd_genopheno_01042018$g6p_odmin = ifelse(pgd_genopheno_01042018$g6p_odmin < 0 , 0 , pgd_genopheno_01042018$g6p_odmin)

##Merging the 2010 and 2011 genotypes
pgd_genopheno_01042018$thal = ifelse(is.na(pgd_genopheno_01042018$thal_2010), pgd_genopheno_01042018$thal_2011, pgd_genopheno_01042018$thal_2010)
pgd_genopheno_01042018$sickle= ifelse(is.na(pgd_genopheno_01042018$sickle_2010), pgd_genopheno_01042018$sickle_2011, pgd_genopheno_01042018$sickle_2010)
pgd_genopheno_01042018$g6pd_202 = ifelse(is.na(pgd_genopheno_01042018$g6pd_202_2010), pgd_genopheno_01042018$g6pd_202_2011, pgd_genopheno_01042018$g6pd_202_2010)

##Converting ly_1 and ba_1 phenotype variables into numerical data types
pgd_genopheno_01042018$ly_1_2010 = as.numeric(as.character(pgd_genopheno_01042018$ly_1_2010))
pgd_genopheno_01042018$ba_1_2010 = as.numeric(as.character(pgd_genopheno_01042018$ba_1_2010))
pgd_genopheno_01042018$ly_1_2011 = as.numeric(as.character(pgd_genopheno_01042018$ly_1_2011))
pgd_genopheno_01042018$ba_1_2011 = as.numeric(as.character(pgd_genopheno_01042018$ba_1_2011))

##Renaming 2010 disease status appropriately
names(pgd_genopheno_01042018)[names(pgd_genopheno_01042018) == 'unwell_greensticker'] = 'unwell_greensticker_2010'
names(pgd_genopheno_01042018)[names(pgd_genopheno_01042018) == 'yellow_sticker'] = 'yellow_sticker_2010'
names(pgd_genopheno_01042018)[names(pgd_genopheno_01042018) == 'orange_sticker'] = 'orange_sticker_2010'
names(pgd_genopheno_01042018)[names(pgd_genopheno_01042018) == 'red_sticker'] = 'red_sticker_2010'
names(pgd_genopheno_01042018)[names(pgd_genopheno_01042018) == 'malariapositive'] = 'uncomplicated_malaria_2010'
names(pgd_genopheno_01042018)[names(pgd_genopheno_01042018) == 'green_malariapositive'] = 'parasitaemia_2010'

##Coding malaria negative individuals as zero. Malaria positive individuals are coded as 1
pgd_genopheno_01042018$uncomplicated_malaria_2010[is.na(pgd_genopheno_01042018$uncomplicated_malaria_2010)] = 0
table(pgd_genopheno_01042018$uncomplicated_malaria_2010)

##Coding healthy chidren who did not report as being unwell(unwell_greensticker) as zero. Children reporting to be unwell coded as 1
pgd_genopheno_01042018$parasitaemia_2010[is.na(pgd_genopheno_01042018$parasitaemia_2010)] = 0
table(pgd_genopheno_01042018$parasitaemia_2010)
pgd_genopheno_01042018$uncomplicated_malaria_2010 = factor(pgd_genopheno_01042018$uncomplicated_malaria_2010, labels = c("NO", "YES"))
pgd_genopheno_01042018$parasitaemia_2010 = factor(pgd_genopheno_01042018$parasitaemia_2010, labels = c("NO", "YES"))

##Creating a variable for malaria status
pgd_genopheno_01042018$malaria_status = ifelse(pgd_genopheno_01042018$parasitaemia_2010 == "NO", "no_malaria" , (ifelse(pgd_genopheno_01042018$uncomplicated_malaria_2010 == "NO", "assymptomatic_malaria", "uncomplicated_malaria") ))
pgd_genopheno_01042018$malaria_status = factor(pgd_genopheno_01042018$malaria_status, levels = c("no_malaria", "assymptomatic_malaria", "uncomplicated_malaria"))

##Converting to data.table format and removing columns where all rows contains NAs
pgd_genopheno_01042018 = as.data.table(pgd_genopheno_01042018)
sapply(pgd_genopheno_01042018,function(x) sum(is.na(x)))
pgd_genopheno_01042018 = pgd_genopheno_01042018[,which(unlist(lapply(pgd_genopheno_01042018, function(x)!all(is.na(x))))),with=F]

##Creating genotype polymorphism array
rbc_polymorphism = c("g6pd_202_rtpcr", "thal", "sickle")

##quoting elements in rbc_polymorphism array so that they can be recognized by dplyr which doesn't evaluate expression in group_by and summarise
rbc_polymorphism_q = c(quo(g6pd_202_rtpcr), quo(thal), quo(sickle))

cbc_array_q_2010 = c(quo(rbc_2010), quo(hgb_2010) , quo(mcv_2010), quo(mch_2010), quo(mchc_2010))
cbc_array_q_2011 = c(quo(rbc_2011), quo(hgb_2011) , quo(mcv_2011), quo(mch_2011), quo(mchc_2010))
cbc_array_2010<-c('rbc_2010', 'hgb_2010', 'mcv_2010', 'mch_2010','mchc_2010')
cbc_array_2011<-c('rbc_2011', 'hgb_2011', 'mcv_2011', 'mch_2011','mchc_2010')
##quoting elements in cbc_array array so that they can be recognized by dplyr which doesn't evaluate expression in group_by and summarise
#cbc_array_q_2010 = c(quo(rbc_2010), quo(hgb_2010) , quo(mcv_2010), quo(mchc_2010), quo(mch_2010), quo(hct_2010), quo(rdw_2010), quo(plt_2010), quo(wbc_2010), quo(ne_2010), quo(ba_2010), quo(mo_2010), quo(eo_2010), quo(ly_2010))
#cbc_array_q_2011 = c(quo(rbc_2011), quo(hgb_2011) , quo(mcv_2011), quo(mchc_2011), quo(mch_2011), quo(hct_2011), quo(rdw_2011))

##Displaying columns where all the cbc traits are missing and removing these
#cbc_array_2010<-c('rbc_2010', 'hgb_2010', 'mcv_2010', 'mchc_2010', 'mch_2010', 'hct_2010', 'rdw_2010', 'plt_2010', 'wbc_2010', 'ne_2010', 'ba_2010', 'mo_2010', 'eo_2010', 'ly_2010')
#cbc_array_2011<-c('rbc_2011', 'hgb_2011', 'mcv_2011', 'mchc_2011', 'mch_2011', 'hct_2011', 'rdw_2011')
cbc_array_all = c('rbc_2010', 'hgb_2010', 'mcv_2010', 'mchc_2010', 'rbc_2011', 'hgb_2011', 'mcv_2011', 'mchc_2011')
#cbc_array_all = c('rbc_2010', 'hgb_2010', 'mcv_2010', 'mchc_2010', 'mch_2010', 'hct_2010', 'rdw_2010', 'rbc_2011', 'hgb_2011', 'mcv_2011', 'mchc_2011', 'mch_2011',  'hct_2011',  'rdw_2011')

ed = c('u_rcc','u_ghb3')
ed_q = c(quo(u_rcc),quo(u_ghb3))

##Converting g6pd_202, thal and sickle variables into the factor datatype
pgd_genopheno_01042018$thal = factor(pgd_genopheno_01042018$thal, labels = c("NORM", "HET", "HOM"))
pgd_genopheno_01042018$sickle = factor(pgd_genopheno_01042018$sickle, labels = c("NORM", "HET", "HOM"))
pgd_genopheno_01042018$g6pd_202 = factor(pgd_genopheno_01042018$g6pd_202, labels = c("NORM", "HET", "HOM/HEMI"))
pgd_genopheno_01042018$sex = factor(pgd_genopheno_01042018$sex, labels = c("FEMALE", "MALE"))

##05022019 Finding individuals with missing RT PCR generated genotypes
individuals_missing_rtpcr_g6pd_202_gtypes = pgd_genopheno_01042018[!pgd_genopheno_01042018$serial %in% g6pd_202_rtpcr$serial,"serial"]
conventnl_202_gtyps_for_individuals_missing_rtpcr_g6pd_202_gtypes = pgd_genopheno_01042018[!pgd_genopheno_01042018$serial %in% g6pd_202_rtpcr$serial,c("serial", "g6pd_202")]
write.csv(conventnl_202_gtyps_for_individuals_missing_rtpcr_g6pd_202_gtypes, "C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/Regenotyping/conventnl_202_gtyps_for_individuals_missing_rtpcr_g6pd_202_gtypes.csv", quote = F, row.names = F)

##05022019 merging genotypes generated by real time PCR with the main dataframe
pgd_genopheno_01042018 = merge(pgd_genopheno_01042018, g6pd_202_rtpcr, by.x = "serial", by.y = "serial" )
pgd_genopheno_01042018$g6pd_202_rtpcr = factor(pgd_genopheno_01042018$g6pd_202_rtpcr, levels = c("NORM", "HET", "HOM/HEMI"))

##05022019 Recoding the G6PD genotypes generated by real time PCR of males determined as being heterozygous to be missing. Probable case of misgenotyping
g6pd_202_rtpcr_migenotyped_males = pgd_genopheno_01042018[ pgd_genopheno_01042018$g6pd_202_rtpcr == "HET" & pgd_genopheno_01042018$sex == "MALE" , c("serial","g6pd_202_rtpcr",  "sex")]
pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018$g6pd_202_rtpcr) & pgd_genopheno_01042018$g6pd_202_rtpcr == "HET" & pgd_genopheno_01042018$sex == "MALE" , "g6pd_202_rtpcr"] = NA
write.csv(pgd_genopheno_01042018, "C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/pgd working directory/HWdE Troubleshooting/bleed_genotypes_phenotypes.csv", quote = F, row.names = F)

##Recoding the G6PD genotype (g6pd_202) of males determined as being heterozygous to be missing. Probable case of misgenotyping
g6pd_202_migenotyped_males = pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018$g6pd_202) & pgd_genopheno_01042018$g6pd_202 == "HET" & pgd_genopheno_01042018$sex == "MALE" , c("g6pd_202", "serial", "sex")]

##Recoding the G6PD genotype into 4 genotypes for different sex (g6pd_202) 
pgd_genopheno_01042018 = as.data.frame(pgd_genopheno_01042018)
pgd_genopheno_01042018$g6pd_202_rtpcr_4_gtypes = pgd_genopheno_01042018$g6pd_202_rtpcr
pgd_genopheno_01042018$g6pd_202_rtpcr_4_gtypes = ifelse(pgd_genopheno_01042018$g6pd_202_rtpcr != "HOM/HEMI", as.character(pgd_genopheno_01042018$g6pd_202_rtpcr), (ifelse(pgd_genopheno_01042018$sex == "MALE", "HEMI", "HOM") ))
pgd_genopheno_01042018$g6pd_202_rtpcr_4_gtypes = factor(pgd_genopheno_01042018$g6pd_202_rtpcr_4_gtypes, levels = c("NORM", "HET", "HOM", "HEMI"))

##Removing all rows for which all rbc cbc data is missing. also recording these individuals
individuals_with_all_rbc_cbc_data_missing = pgd_genopheno_01042018[apply(pgd_genopheno_01042018[,cbc_array_2010], 1, function(x)all(is.na(x))),c("serial", "g6pd_202_rtpcr")]
pgd_genopheno_01042018 = pgd_genopheno_01042018[apply(pgd_genopheno_01042018[,cbc_array_2010], 1, function(x)any(!is.na(x))),]

##list of individuals classified as normal based on the G6PD202 genotype but appear deficient based on the ughb phenotype and vice versa
gtype_norm_ptype_def = pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb"] < 2 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM",]
write.csv(gtype_norm_ptype_def, "C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/Regenotyping/gtype_norm_ptype_def.csv", quote = F, row.names = F)
ptype_norm_gtype_def = pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb"] > 4 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI",]
write.csv(ptype_norm_gtype_def, "C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/Regenotyping/ptype_norm_gtype_def.csv", quote = F, row.names = F)

##boxplot and kruskal walis of mch (can be done for other traits) in individuals classified as normal based on the G6PD202 genotype but appear deficient (<2) based on the ughb phenotype vs those normal by both phenotype (>2) and genotype
boxplot(pgd_genopheno_01042018[pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "mch_2010"] ~ as.factor(pgd_genopheno_01042018[pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM","u_ghb"] < 2))
kruskal.test(pgd_genopheno_01042018[pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "mch_2010"] ~ as.factor(pgd_genopheno_01042018[pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM","u_ghb"] < 2))
pgd_genopheno_01042018$g6p_odmin = ifelse(is.na(pgd_genopheno_01042018[, "comments"]), pgd_genopheno_01042018[,"g6p_odmin"], NA)
pgd_genopheno_01042018$u_rcc = (pgd_genopheno_01042018$g6p_odmin * 200 * 10^12) / (pgd_genopheno_01042018$rbc_2010*6.22*8*0.05*10^6*1000)
pgd_genopheno_01042018$u_rcc = ifelse(pgd_genopheno_01042018$u_rcc < 0 , 0 , pgd_genopheno_01042018$u_rcc)
pgd_genopheno_01042018$u_rcc2 = (pgd_genopheno_01042018$g6p_odmin * 200 * 10^12) / (pgd_genopheno_01042018$rbc_2010*6.22*8*0.05*10^6*1000*(100/pgd_genopheno_01042018$hct_2010))
pgd_genopheno_01042018$u_rcc2 = ifelse(pgd_genopheno_01042018$u_rcc2 < 0 , 0 , pgd_genopheno_01042018$u_rcc2)
pgd_genopheno_01042018$u_ghb2 = (pgd_genopheno_01042018$g6p_odmin * 200 * 100 ) / (pgd_genopheno_01042018$hgb_2010*6.22*8*0.05*(100/pgd_genopheno_01042018$hct_2010))
pgd_genopheno_01042018$u_ghb2 = ifelse(pgd_genopheno_01042018$u_ghb2 < 0 , 0 , pgd_genopheno_01042018$u_ghb2)
pgd_genopheno_01042018$u_ghb3 = (pgd_genopheno_01042018$g6p_odmin * 200*100 ) / (pgd_genopheno_01042018$hgb_2010*6.22*8*0.05)
pgd_genopheno_01042018$u_ghb3 = ifelse(pgd_genopheno_01042018$u_ghb3 < 0 , 0 , pgd_genopheno_01042018$u_ghb3)

##list of individuals classified as normal based on the G6PD202 genotype but appear deficient based on the ughb phenotype and vice versa
gtype_norm_ptype_def = pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb3"] < 2 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM",]
write.csv(gtype_norm_ptype_def, "C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/Regenotyping/gtype_norm_ptype_def.csv", quote = F, row.names = F)
ptype_norm_gtype_def = pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb3"] > 4 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI",]
write.csv(ptype_norm_gtype_def, "C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/Regenotyping/ptype_norm_gtype_def.csv", quote = F, row.names = F)

##Cross-sectional bleed malaria data from Caro Bundi
weekly_bleed_surveillance_2005_2018 = read.csv("C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/cross sectional bleed parasitaemia/Junju_weekly_2005_2018.csv", stringsAsFactors = F, na.strings = c("NA", "", ".", "<NA>"))
weekly_bleed_gtypes = merge(pgd_genopheno_01042018[,c(1,109,110,113)], weekly_bleed_surveillance_2005_2018, by.x = "serial", by.y = "studyno")

ethnicity_location_malaria = read.csv("C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/pgd working directory/malaria positivity and ethnic information/20200109_data_request_jrop.csv", stringsAsFactors = F, na.strings = c("NA", "", ".", "<NA>"))
pgd_genopheno_01042018 = merge(pgd_genopheno_01042018, ethnicity_location_malaria, by.x = "serial", by.y  = "studyno", all.x = T)
pgd_genopheno_01042018$ethnic = as.factor(pgd_genopheno_01042018$ethnic)
pgd_genopheno_01042018$location = as.factor(pgd_genopheno_01042018$location)
```

#CALCULATING HWE

```{r hwe&dates_formating, echo=F, warning=F}
##Autosomal traits: Thal and sickle 
pander("<B><U>HWE for thal genotypes in all individuals</U></B>")
pgd_genopheno_01042018 %>% filter( !is.na(thal)) %>% count(thal)
pgd_genopheno_01042018 %>% filter( !is.na(thal)) %>% count(thal) %>% with(pander(HWChisq(n)))
pander("<B><U>HWE for thal genotypes in 2010 malaria negative individuals</U></B>")
pgd_genopheno_01042018 %>% filter( !is.na(thal) & uncomplicated_malaria_2010 == "NO") %>% count(thal)
pgd_genopheno_01042018 %>% filter( !is.na(thal) & uncomplicated_malaria_2010 == "NO") %>% count(thal) %>% with(pander(HWChisq(n)))

pander("<B><U>HWE for thal genotypes in individuals who also have g6pd_202_rtpcr genotypes</U></B>")
pgd_genopheno_01042018 %>% filter( !is.na(thal) & !is.na(g6pd_202_rtpcr)) %>% count(thal)
pgd_genopheno_01042018 %>% filter( !is.na(thal) & !is.na(g6pd_202_rtpcr)) %>% count(thal) %>% with(pander(HWChisq(n)))
pander("<B><U>HWE for thal genotypes in 2010 malaria negative individuals who also have thal and g6pd_202_rtpcr genotypes</U></B>")
pgd_genopheno_01042018 %>% filter( !is.na(thal) & !is.na(g6pd_202_rtpcr) & uncomplicated_malaria_2010 == "NO" ) %>% count(thal)
pgd_genopheno_01042018 %>% filter( !is.na(thal) & !is.na(g6pd_202_rtpcr) & uncomplicated_malaria_2010 == "NO" ) %>% count(thal) %>% with(pander(HWChisq(n)))

pander("<B><U>HWE for HbS genotypes in all individuals</U></B>")
pgd_genopheno_01042018 %>% filter( !is.na(sickle)) %>% count(sickle)
pgd_genopheno_01042018 %>% filter( !is.na(sickle)) %>% count(sickle) %>% with(pander(HWChisq(n)))
pander("<B><U>HWE for HbS genotypes in 2010 malaria negative individuals</U></B>")
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & uncomplicated_malaria_2010 == "NO") %>% count(sickle)
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & uncomplicated_malaria_2010 == "NO") %>% count(sickle) %>% with(pander(HWChisq(n)))

pander("<B><U>HWE for sickle genotypes in individuals who also have g6pd_202_rtpcr genotypes</U></B>")
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(g6pd_202_rtpcr)) %>% count(sickle)
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(g6pd_202_rtpcr)) %>% count(sickle) %>% with(pander(HWChisq(n)))
pander("<B><U>HWE for sickle genotypes in 2010 malaria negative individuals who also have thal and g6pd_202_rtpcr genotypes</U></B>")
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(g6pd_202_rtpcr) & uncomplicated_malaria_2010 == "NO") %>% count(sickle)
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(g6pd_202_rtpcr) & uncomplicated_malaria_2010 == "NO") %>% count(sickle) %>% with(pander(HWChisq(n)))

pander("<B><U>HWE for g6pd_202_rtpcr genotypes in all individuals</U></B>")
##X-linked trait: G6PD
pgd_genopheno_01042018 = pgd_genopheno_01042018 %>% mutate(sex_integercoded = ifelse(sex == "MALE", "1" , "2" ))

g6pd_genotype_frequencies = pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr)) %>% count(sex_integercoded, g6pd_202_rtpcr) %>% transmute(n) %>% unlist(n)
names(g6pd_genotype_frequencies) = c("A", "B", "AA", "AB", "BB")
##counts of normal males, hemi, normal females, hets and homs
print(g6pd_genotype_frequencies)
pander(HWChisq(g6pd_genotype_frequencies, x.linked = T))
pander("<B><U>HWE for g6pd_202_rtpcr genotypes in 2010 malaria negative individuals</U></B>")
##X-linked trait: G6PD
pgd_genopheno_01042018 = pgd_genopheno_01042018 %>% mutate(sex_integercoded = ifelse(sex == "MALE", "1" , "2" ))

g6pd_genotype_frequencies = pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr) & uncomplicated_malaria_2010 == "NO") %>% count(sex_integercoded, g6pd_202_rtpcr) %>% transmute(n) %>% unlist(n)
names(g6pd_genotype_frequencies) = c("A", "B", "AA", "AB", "BB")
##counts of normal males, hemi, normal females, hets and homs
print(g6pd_genotype_frequencies)
pander(HWChisq(g6pd_genotype_frequencies, x.linked = T))

##Loading the lubridate package for formatting dates and formatting the dob and date_collection3 (collection date) to appropriate format
pgd_genopheno_01042018$dob = parse_date_time(as.character(pgd_genopheno_01042018$dob), "ymd")
pgd_genopheno_01042018$date_collect3_2010 = parse_date_time(as.character(pgd_genopheno_01042018$date_collect3_2010), "ymd")
pgd_genopheno_01042018$date_collect3_2011 = parse_date_time(as.character(pgd_genopheno_01042018$date_collect3_2011), "ymd")

pgd_genopheno_01042018$age_at_collection_2010 = as.period(interval(pgd_genopheno_01042018$dob, pgd_genopheno_01042018$date_collect3_2010))
pgd_genopheno_01042018$age_at_collection_months_2010 = as.numeric(pgd_genopheno_01042018$age_at_collection_2010, "months")
pgd_genopheno_01042018$age_at_collection_years_2010 = as.numeric(pgd_genopheno_01042018$age_at_collection_2010, "years")

pgd_genopheno_01042018$age_at_collection_2011 = as.period(interval(pgd_genopheno_01042018$dob, pgd_genopheno_01042018$date_collect3_2011))
pgd_genopheno_01042018$age_at_collection_months_2011 = as.numeric(pgd_genopheno_01042018$age_at_collection_2011, "months")
pgd_genopheno_01042018$age_at_collection_years_2011 = as.numeric(pgd_genopheno_01042018$age_at_collection_2011, "years")

##Removing the interval columns since they give an error on dlpyr
pgd_genopheno_01042018$age_at_collection_2010 = NULL
pgd_genopheno_01042018$age_at_collection_2011 = NULL

#Removing rows where all CBC results are missing
cbc_colNA_index =  apply(pgd_genopheno_01042018[,cbc_array_all], 1, function(x) all(is.na(x)))
pgd_genopheno_01042018 = pgd_genopheno_01042018[!cbc_colNA_index,]
```

#DATA TABULATION

##Tabulating the distribution of gender, age among individuals of the different g6pd_202_rtpcr, thal and sickle genotypes before removal of sicklers and outliers

```{r gender&age_tables1, echo=F, results='hide'}
panderOptions('table.split.table', Inf)
geno_exploration = function(age_at_collection_years , malariapositive, malariapositive1){
  
  geno_a = do.call(rbind, lapply(pgd_genopheno_01042018[, rbc_polymorphism], function(x) addmargins(table(droplevels(x), pgd_genopheno_01042018[ , "sex"]))))
  geno_b = do.call(rbind, lapply(pgd_genopheno_01042018[, rbc_polymorphism], function(x) addmargins(round(100*prop.table(table(droplevels(x),pgd_genopheno_01042018[, "sex"]), margin = 2), digits = 2))))
  geno_c = do.call(rbind, lapply(pgd_genopheno_01042018[, rbc_polymorphism], function(x) addmargins(round(100*prop.table(table(droplevels(x),pgd_genopheno_01042018[, "sex"]), margin = 1), digits = 2))))
    
  geno_d = do.call(rbind, lapply(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[, "g6pd_202_rtpcr"]), rbc_polymorphism], function(x) addmargins(table(droplevels(x),pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"g6pd_202_rtpcr"]) , "sex"]))))
  geno_e = do.call(rbind, lapply(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[, "g6pd_202_rtpcr"]), rbc_polymorphism], function(x) addmargins(round(100*prop.table(table(droplevels(x),pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"g6pd_202_rtpcr"]) , "sex"]), margin = 2), digits = 2))))
  geno_f = do.call(rbind, lapply(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[, "g6pd_202_rtpcr"]), rbc_polymorphism], function(x) addmargins(round(100*prop.table(table(droplevels(x),pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"g6pd_202_rtpcr"]) , "sex"]), margin = 1), digits = 2))))
    
  geno_g = do.call(rbind, lapply(pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive1] == "NO", rbc_polymorphism], function(x) addmargins(table(droplevels(x),pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive1] == "NO", "sex"]))))
  geno_h = do.call(rbind, lapply(pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive1] == "NO", rbc_polymorphism], function(x) addmargins(round(100*prop.table(table(droplevels(x),pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive1] == "NO", "sex"]), margin = 2), digits = 2))))
  geno_i = do.call(rbind, lapply(pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive1] == "NO", rbc_polymorphism], function(x) addmargins(round(100*prop.table(table(droplevels(x),pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive1] == "NO", "sex"]), margin = 1), digits = 2))))
    
  geno_j = do.call(rbind, lapply(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[, "g6pd_202_rtpcr"]) & pgd_genopheno_01042018[, malariapositive1] == "NO", rbc_polymorphism], function(x) addmargins(table(droplevels(x),pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"g6pd_202_rtpcr"])& pgd_genopheno_01042018[, malariapositive1] == "NO" , "sex"]))))
  geno_k = do.call(rbind, lapply(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[, "g6pd_202_rtpcr"]) & pgd_genopheno_01042018[, malariapositive1] == "NO", rbc_polymorphism], function(x) addmargins(round(100*prop.table(table(droplevels(x),pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"g6pd_202_rtpcr"])& pgd_genopheno_01042018[, malariapositive1] == "NO" , "sex"]), margin = 2), digits = 2))))
  geno_l = do.call(rbind, lapply(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[, "g6pd_202_rtpcr"]) & pgd_genopheno_01042018[, malariapositive1] == "NO", rbc_polymorphism], function(x) addmargins(round(100*prop.table(table(droplevels(x),pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"g6pd_202_rtpcr"])& pgd_genopheno_01042018[, malariapositive1] == "NO" , "sex"]), margin = 1), digits = 2))))
    
    mal_genoexpl = as.data.frame(rbind(cbind(geno_a, geno_b, geno_c, geno_d, geno_e, geno_f), cbind(geno_g, geno_h, geno_i, geno_j, geno_k, geno_l)))

    geno_m = list()
    geno_n = list()
    geno_o = list()
    geno_p = list()
    for (j in 1:length(rbc_polymorphism)) {

    malariapositive = enquo(malariapositive)
    age_at_collection_years = enquo(age_at_collection_years)
    geno_m[[length(geno_m)+1]] = pgd_genopheno_01042018 %>% filter( !is.na(!!rbc_polymorphism_q[[j]])) %>% group_by(!!rbc_polymorphism_q[[j]]) %>% summarise(mean = mean(!!age_at_collection_years, na.rm = T), sd = sd(!!age_at_collection_years, na.rm = T), median= median(!!age_at_collection_years, na.rm = T), iqr = IQR(!!age_at_collection_years, na.rm = T), min = min(!!age_at_collection_years, na.rm = T), max=max(!!age_at_collection_years, na.rm = T), q25=quantile(!!age_at_collection_years, probs = 0.25, na.rm = T), q75=quantile(!!age_at_collection_years, probs = 0.75, na.rm = T)) 
    geno_n[[length(geno_n)+1]] = pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr) & !is.na(!!rbc_polymorphism_q[[j]])) %>% group_by(!!rbc_polymorphism_q[[j]]) %>% summarise(mean = mean(!!age_at_collection_years, na.rm = T), sd = sd(!!age_at_collection_years, na.rm = T), median= median(!!age_at_collection_years, na.rm = T), iqr = IQR(!!age_at_collection_years, na.rm = T), min = min(!!age_at_collection_years, na.rm = T), max=max(!!age_at_collection_years, na.rm = T), q25=quantile(!!age_at_collection_years, probs = 0.25, na.rm = T), q75=quantile(!!age_at_collection_years, probs = 0.75, na.rm = T))
    geno_o[[length(geno_o)+1]] = pgd_genopheno_01042018 %>% filter( UQ(malariapositive) == "NO" & !is.na(!!rbc_polymorphism_q[[j]])) %>% group_by(!!rbc_polymorphism_q[[j]]) %>% summarise(mean = mean(!!age_at_collection_years, na.rm = T), sd = sd(!!age_at_collection_years, na.rm = T), median= median(!!age_at_collection_years, na.rm = T), iqr = IQR(!!age_at_collection_years, na.rm = T), min = min(!!age_at_collection_years, na.rm = T), max=max(!!age_at_collection_years, na.rm = T), q25=quantile(!!age_at_collection_years, probs = 0.25, na.rm = T), q75=quantile(!!age_at_collection_years, probs = 0.75, na.rm = T)) 
    geno_p[[length(geno_p)+1]] = pgd_genopheno_01042018 %>% filter( UQ(malariapositive) == "NO" & !is.na(g6pd_202_rtpcr) & !is.na(!!rbc_polymorphism_q[[j]])) %>% group_by(!!rbc_polymorphism_q[[j]]) %>% summarise(mean = mean(!!age_at_collection_years, na.rm = T), sd = sd(!!age_at_collection_years, na.rm = T), median= median(!!age_at_collection_years, na.rm = T), iqr = IQR(!!age_at_collection_years, na.rm = T), min = min(!!age_at_collection_years, na.rm = T), max=max(!!age_at_collection_years, na.rm = T), q25=quantile(!!age_at_collection_years, probs = 0.25, na.rm = T), q75=quantile(!!age_at_collection_years, probs = 0.75, na.rm = T)) 
    }
    geno_m = rbindlist(geno_m)
    geno_n = rbindlist(geno_n)
    geno_o = rbindlist(geno_o)
    geno_p = rbindlist(geno_p)
    
    geno_q = as.data.frame(rbind(geno_m, geno_n, geno_o, geno_p))
    return(list(mal_genoexpl,geno_q))
}
geno_exp_list = geno_exploration(age_at_collection_years = age_at_collection_years_2010, malariapositive = uncomplicated_malaria_2010, malariapositive1 = "uncomplicated_malaria_2010")

rownames(geno_exp_list[[1]]) = row.names=c("G_all_NM","G_all_HT", "G_all_HM","G_all_sum","T_all_NM","T_all_HT","T_all_HM","T_all_sum","S_all_NM","S_all_HT","S_all_HM","S_all_sum","G_mn_NM","G_mn_HT", "G_mn_HM","G_mn_sum","T_mn_NM","T_mn_HT","T_mn_HM","T_mn_sum","S_mn_NM","S_mn_HT","S_mn_HM","S_mn_sum")
colnames(geno_exp_list[[1]]) = c( "all_F", "all_M", "all_sum", "%dwnF", "%dwnM", "%dwnSum", "%acrsF", "%acrsM", "%acrsSum", "all_G_F", "all_G_M", "all_G_sum", "%G_acrsF", "%G_acrsM", "%G_acrsSum", "%G_dwnF", "%G_dwnM", "%G_dwnSum")
rownames(geno_exp_list[[2]])[1:9] = paste("all", rownames(geno_exp_list[[2]])[1:9], sep = "_")
rownames(geno_exp_list[[2]])[10:18] = paste("all_g6pd", rownames(geno_exp_list[[2]])[10:18], sep = "_")
rownames(geno_exp_list[[2]])[19:27] = paste("mn", rownames(geno_exp_list[[2]])[19:27], sep = "_")
rownames(geno_exp_list[[2]])[28:36] = paste("mn_g6pd" , rownames(geno_exp_list[[2]])[28:36], sep = "_")

rownames(geno_exp_list[[2]])[c(1:3,10:12,19:21,28:30)] = paste("G", rownames(geno_exp_list[[2]])[c(1:3,10:12,19:21,28:30)], sep = "_")
rownames(geno_exp_list[[2]])[c(4:6,13:15,22:24,31:33)] = paste("T", rownames(geno_exp_list[[2]])[c(4:6,13:15,22:24,31:33)], sep = "_")
rownames(geno_exp_list[[2]])[c(7:9,16:18,25:27,34:36)] = paste("S", rownames(geno_exp_list[[2]])[c(7:9,16:18,25:27,34:36)], sep = "_")

rownames(geno_exp_list[[2]]) = paste(rownames(geno_exp_list[[2]]), geno_exp_list[[2]]$g6pd_202_rtpcr, sep = "_")

geno_exp_list[[2]][,"g6pd_202_rtpcr"] = NULL

cat('Gender distribution' )
cat('Key => G=g6pd_202_rtpcr, T=thal, S=sickle, mn=malarianegative, NM=NORM, HT=HET, HM=HOM, M=male, F=female, acrs=across, dwn=down' )
pander(geno_exp_list[[1]])

cat('Age distribution' )
cat('Key => G=g6pd_202_rtpcr, T=thal, S=sickle, mn=malarianegative, NM=NORM, HT=HET, HM=HOM, M=male, F=female, acrs=across, dwn=down' )
pander(geno_exp_list[[2]])
```

##Tabulating the distribution of individuals with different g6pd_202_rtpcr, thal and sickle genotypes among those with CBC data before removal of sicklers and outliers

```{r cbc_table1, echo=F, results='hide'}
panderOptions('table.split.table', Inf)
cbc_exploration = function(cbc_array, malariapositive) {
  
  cbc_m = list()
  cbc_n = list()
  cbc_o = list()
  cbc_p = list()
  for (i in 1:length(cbc_array)) {
    
    cbc_m[[length(cbc_m)+1]] = do.call(rbind, lapply(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[, cbc_array[i]]), rbc_polymorphism], function(x) addmargins(table(droplevels(x),!is.na(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,cbc_array[i]]), cbc_array[i]])), margin = 1)))
    cbc_n[[length(cbc_n)+1]] = do.call(rbind, lapply(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[, cbc_array[i]]) & !is.na(pgd_genopheno_01042018[, "g6pd_202_rtpcr"]), rbc_polymorphism], function(x)addmargins(table(droplevels(x),!is.na(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,cbc_array[i]]) & !is.na(pgd_genopheno_01042018[, "g6pd_202_rtpcr"]), cbc_array[i]])), margin = 1)))
    
    cbc_o[[length(cbc_o)+1]] = do.call(rbind, lapply(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[, cbc_array[i]]) & pgd_genopheno_01042018[, malariapositive] == "NO", rbc_polymorphism], function(x)addmargins(table(droplevels(x),!is.na(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,cbc_array[i]]) & pgd_genopheno_01042018[, malariapositive] == "NO", cbc_array[i]])), margin = 1)))
    cbc_p[[length(cbc_p)+1]] = do.call(rbind, lapply(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[, cbc_array[i]]) & !is.na(pgd_genopheno_01042018[, "g6pd_202_rtpcr"]) & pgd_genopheno_01042018[, malariapositive] == "NO", rbc_polymorphism], function(x)addmargins(table(droplevels(x),!is.na(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,cbc_array[i]]) & !is.na(pgd_genopheno_01042018[, "g6pd_202_rtpcr"]) & pgd_genopheno_01042018[, malariapositive] == "NO", cbc_array[i]])), margin = 1)))
}
  
  cbc_m = cbind.data.frame(cbc_m)
  cbc_n = cbind.data.frame(cbc_n)
  cbc_o = cbind.data.frame(cbc_o)
  cbc_p = cbind.data.frame(cbc_p)
  
  cbc_q = as.data.frame(rbind(cbc_m, cbc_n, cbc_o, cbc_p))
  
  return(cbc_q)
  }
cbc_exp_list = cbc_exploration(cbc_array = cbc_array_2010, malariapositive = "uncomplicated_malaria_2010")

rownames(cbc_exp_list)[1:12] = paste("all", rownames(cbc_exp_list)[1:12], sep = "_")
rownames(cbc_exp_list)[13:24] = paste("all_g6pd", rownames(cbc_exp_list)[13:24], sep = "_")
rownames(cbc_exp_list)[25:36] = paste("mn", rownames(cbc_exp_list)[25:36], sep = "_")
rownames(cbc_exp_list)[37:48] = paste("mn_g6pd" , rownames(cbc_exp_list)[37:48], sep = "_")

rownames(cbc_exp_list)[c(1:4,13:16,25:28,37:40)] = paste("G", rownames(cbc_exp_list)[c(1:4,13:16,25:28,37:40)], sep = "_")
rownames(cbc_exp_list)[c(5:8,17:20,29:32,41:44)] = paste("T", rownames(cbc_exp_list)[c(5:8,17:20,29:32,41:44)], sep = "_")
rownames(cbc_exp_list)[c(9:12,21:24,33:36,45:48)] = paste("S", rownames(cbc_exp_list)[c(9:12,21:24,33:36,45:48)], sep = "_")

colnames(cbc_exp_list) = cbc_array_2010

pander(cbc_exp_list)
```


```{r sicklers rm, echo=F}
##recalculating HWE for sickle
pander("<B><U>HWE for sickle genotypes in all individuals</U></B>")
pgd_genopheno_01042018 %>% filter( !is.na(sickle)) %>% count(sickle)
pgd_genopheno_01042018 %>% filter( !is.na(sickle)) %>% count(sickle) %>% with(pander(HWChisq(n)))
pander("<B><U>HWE for thal genotypes in all malaria negative individuals</U></B>")
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & uncomplicated_malaria_2010 == "NO") %>% count(sickle)
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & uncomplicated_malaria_2010 == "NO") %>% count(sickle) %>% with(pander(HWChisq(n)))

##Removing 2 sicklers
pander("<B><U>Tabulating and removing 2 sicklers in the dataset before recalculating HWE but for g6pd_202_rtpcr and thal only</U></B>")
pgd_genopheno_01042018[pgd_genopheno_01042018$sickle == "HOM", c("serial", "sickle")]
pgd_sicklers_data = pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018$sickle) & pgd_genopheno_01042018$sickle == "HOM" , ]
pgd_genopheno_01042018 = pgd_genopheno_01042018[!(!is.na(pgd_genopheno_01042018$sickle) & pgd_genopheno_01042018$sickle == "HOM") , ]
pgd_genopheno_01042018$sickle = droplevels(pgd_genopheno_01042018$sickle)
```

##unadjusted analysis of g6pd202 on cbc indices before removal of those with incomplete genotypes {.tabset}

```{r, echo=F, results= 'asis', warning=F, eval=F}
panderOptions('knitr.auto.asis', FALSE) 
panderOptions('table.split.table', Inf)
pgd_cbc_vs_rbcpol_mvrt_rgrs = function(cbc_array, malariapositive, age_at_collection_years) {
  for (j in 1:length(cbc_array)) {
    cat('###',cbc_array[j], ' \n')
    
    b = pgd_genopheno_01042018[ , c (rbc_polymorphism, age_at_collection_years, "sex", malariapositive, "ethnic" cbc_array[j])]
    
    #cat("tukeyHSD____________________________________________________________ \n")
    ##tukeyHSD for comparison of each cbc trait between all possible groups per rbc polmorphism
    #pander(TukeyHSD(aov(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(4,length(b))]), collapse = "+") )), data = b)),add.significance.stars = T)

    cat("lm__________________________________________________________________ \n")
    ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
    pander(summary(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[1] )), data = b)),add.significance.stars = T)
    pander(confint(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[1] )), data = b), level=0.95))
    pander(table(b[!is.na(b[,1]) & !is.na(b[,cbc_array[j]]),1] ))

    pander(summary(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[2] )), data = b)),add.significance.stars = T)
    pander(confint(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[2] )), data = b), level=0.95))
    pander(table(b[!is.na(b[,2]) & !is.na(b[,cbc_array[j]]),2] ))    

    pander(summary(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[3] )), data = b)),add.significance.stars = T)
    pander(confint(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[3] )), data = b), level=0.95))
    pander(table(b[!is.na(b[,3]) & !is.na(b[,cbc_array[j]]),3] ))    
    
    pander(summary(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[4] )), data = b)),add.significance.stars = T)
    pander(confint(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[4] )), data = b), level=0.95))
    pander(table(!is.na(b[!is.na(b[,4]) & !is.na(b[,cbc_array[j]]),4] )))

    pander(summary(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[5] )), data = b)),add.significance.stars = T)
    pander(confint(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[5] )), data = b), level=0.95))
    pander(table(b[!is.na(b[,5]) & !is.na(b[,cbc_array[j]]),5] ))    
    
    pander(summary(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[6] )), data = b)),add.significance.stars = T)
    pander(confint(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[6] )), data = b), level=0.95))
    pander(table(b[!is.na(b[,6]) & !is.na(b[,cbc_array[j]]),6] ))    

    pander(summary(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(3,6,length(b))]), collapse = "+") )), data = b)),add.significance.stars = T)
    pander(confint(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(3,6,length(b))]), collapse = "+") )), data = b), level=0.95))
    pander(kable(emmeans(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(3,6,length(b))]), collapse = "+") )), data = b), as.formula(paste("~ ", colnames(b)[1], " | ", colnames(b)[2])))))
    cat(' \n')
    
    ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
    par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
    plot(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(3,6,length(b))]), collapse = "+") )), data = b))
    
    cat(' \n \n')
  }
}
pgd_cbc_vs_rbcpol_mvrt_rgrs(cbc_array= cbc_array_2010, malariapositive= 'malaria_status', age_at_collection_years = 'age_at_collection_years_2010')
```

```{r HWE_recalculation, echo=F}
##Removing 4 individuals missing either of 3 genotypes
indv_with_incomplete_gtype_set = pgd_genopheno_01042018[apply(pgd_genopheno_01042018[,rbc_polymorphism], 1, function(x)any(is.na(x))),c("serial", "g6pd_202_rtpcr", "sickle","thal")]
pgd_genopheno_01042018 = pgd_genopheno_01042018[apply(pgd_genopheno_01042018[,rbc_polymorphism], 1, function(x)all(!is.na(x))),]
 
##Autosomal traits: Thal and sickle 
pander("<B><U>HWE for thal genotypes in all individuals</U></B>")
pgd_genopheno_01042018 %>% filter( !is.na(thal)) %>% count(thal)
pgd_genopheno_01042018 %>% filter( !is.na(thal)) %>% count(thal) %>% with(pander(HWChisq(n)))
pander("<B><U>HWE for thal genotypes in all malaria negative individuals</U></B>")
pgd_genopheno_01042018 %>% filter( !is.na(thal) & uncomplicated_malaria_2010 == "NO") %>% count(thal)
pgd_genopheno_01042018 %>% filter( !is.na(thal) & uncomplicated_malaria_2010 == "NO") %>% count(thal) %>% with(pander(HWChisq(n)))

pander("<B><U>HWE for thal genotypes in individuals who also have thal and g6pd_202_rtpcr genotypes</U></B>")
pgd_genopheno_01042018 %>% filter( !is.na(thal) & !is.na(g6pd_202_rtpcr)) %>% count(thal)
pgd_genopheno_01042018 %>% filter( !is.na(thal) & !is.na(g6pd_202_rtpcr)) %>% count(thal) %>% with(pander(HWChisq(n)))
pander("<B><U>HWE for thal genotypes in 2010 malaria negative individuals who also have thal and g6pd_202_rtpcr genotypes</U></B>")
pgd_genopheno_01042018 %>% filter( !is.na(thal) & !is.na(g6pd_202_rtpcr) & uncomplicated_malaria_2010 == "NO" ) %>% count(thal)
pgd_genopheno_01042018 %>% filter( !is.na(thal) & !is.na(g6pd_202_rtpcr) & uncomplicated_malaria_2010 == "NO" ) %>% count(thal) %>% with(pander(HWChisq(n)))

pander("<B><U>HWE for g6pd_202_rtpcr genotypes in all individuals</U></B>")
##X-linked trait: G6PD
pgd_genopheno_01042018 = pgd_genopheno_01042018 %>% mutate(sex_integercoded = ifelse(sex == "MALE", "1" , "2" ))

g6pd_genotype_frequencies = pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr)) %>% count(sex_integercoded, g6pd_202_rtpcr) %>% transmute(n) %>% unlist(n)
names(g6pd_genotype_frequencies) = c("A", "B", "AA", "AB", "BB")
##counts of normal males, hemi, normal females, hets and homs
print(g6pd_genotype_frequencies)
pander(HWChisq(g6pd_genotype_frequencies, x.linked = T))
pander("<B><U>HWE for g6pd_202_rtpcr genotypes in all malaria negative individuals</U></B>")
##X-linked trait: G6PD
pgd_genopheno_01042018 = pgd_genopheno_01042018 %>% mutate(sex_integercoded = ifelse(sex == "MALE", "1" , "2" ))

g6pd_genotype_frequencies = pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr) & uncomplicated_malaria_2010 == "NO") %>% count(sex_integercoded, g6pd_202_rtpcr) %>% transmute(n) %>% unlist(n)
names(g6pd_genotype_frequencies) = c("A", "B", "AA", "AB", "BB")
##counts of normal males, hemi, normal females, hets and homs
print(g6pd_genotype_frequencies)
pander(HWChisq(g6pd_genotype_frequencies, x.linked = T))

age_at_collection = c("age_at_collection_months_2010", "age_at_collection_months_2011", "age_at_collection_years_2010", "age_at_collection_years_2011")
```



#EXPLORATORY DATA ANALYSIS

##Checking normality and equal variance of the phenotypes (non-transformed & transformed) in all and in malaria negative individuals

```{r hist_box_plots, echo=F}
eda_tests = function(cbc_array  , malariapositive , parasitaemia) {
  par(mfrow = c(4,2), mar = c(2,3,1.5,0.5))
  print(mapply(hist, pgd_genopheno_01042018[, cbc_array], main=cbc_array))
  print(mapply(boxplot, pgd_genopheno_01042018[, cbc_array], main=cbc_array))
  print(mapply(boxplot, log(pgd_genopheno_01042018[, cbc_array]), main=paste("log" , cbc_array)))
  print(mapply(boxplot, sqrt(pgd_genopheno_01042018[, cbc_array]), main=paste("sqrt" , cbc_array)))
  print(mapply(boxplot, 1/pgd_genopheno_01042018[, cbc_array], main=paste("inverse" , cbc_array)))
  
  print(mapply(hist, pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive] =="NO" , cbc_array], main=paste(cbc_array, "mal_neg")))
  print(mapply(boxplot, pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive] =="NO" , cbc_array], main=paste(cbc_array, "mal_neg")))
  
  print(mapply(hist, pgd_genopheno_01042018[pgd_genopheno_01042018[, parasitaemia] =="NO" , cbc_array], main=paste(cbc_array, "grnmal_neg")))
  print(mapply(boxplot, pgd_genopheno_01042018[pgd_genopheno_01042018[, parasitaemia] =="NO" , cbc_array], main=paste(cbc_array, "grnmal_neg")))
  
  print(mapply(hist, pgd_genopheno_01042018[, age_at_collection], main=age_at_collection))
  
  }
```

```{r normality_equalvar, echo=F}
eda_pval = function(cbc_array  , malariapositive , parasitaemia ) {
  
  a1 = do.call(rbind, lapply(pgd_genopheno_01042018[,cbc_array], function(x) shapiro.test(x)[ "p.value"]))
  a2 = do.call(rbind, lapply(log10(pgd_genopheno_01042018[,cbc_array]), function(x) shapiro.test(x)["p.value"]))
  a3 = do.call(rbind, lapply(sqrt(pgd_genopheno_01042018[,cbc_array]), function(x) shapiro.test(x)["p.value"]))
  a4 = do.call(rbind, lapply(1/(pgd_genopheno_01042018[,cbc_array]), function(x) shapiro.test(x)["p.value"]))
  
  b1 = do.call(rbind, lapply(pgd_genopheno_01042018[,cbc_array], function(x) var.test(x ~ pgd_genopheno_01042018$sickle)["p.value"]))
  b2 = do.call(rbind, lapply(pgd_genopheno_01042018[,cbc_array], function(x) bartlett.test(x ~ pgd_genopheno_01042018$g6pd_202_rtpcr)["p.value"]))
  b3 = do.call(rbind, lapply(pgd_genopheno_01042018[,cbc_array], function(x) bartlett.test(x ~ pgd_genopheno_01042018$thal)["p.value"]))
  b4 = do.call(rbind, lapply(pgd_genopheno_01042018[,cbc_array], function(x) fligner.test(x ~ pgd_genopheno_01042018$g6pd_202_rtpcr)["p.value"]))
  b5 = do.call(rbind, lapply(pgd_genopheno_01042018[,cbc_array], function(x) fligner.test(x ~ pgd_genopheno_01042018$thal)["p.value"]))
  
  c1 = do.call(rbind, lapply(pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive] =="NO", cbc_array], function(x) shapiro.test(x)["p.value"])) 
  c2 = do.call(rbind, lapply(log10(pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive] =="NO" ,cbc_array]), function(x) shapiro.test(x)["p.value"]))
  c3 = do.call(rbind, lapply(sqrt(pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive] =="NO" ,cbc_array]), function(x) shapiro.test(x)["p.value"]))
  c4 = do.call(rbind, lapply(1/(pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive] =="NO" ,cbc_array]), function(x) shapiro.test(x)["p.value"]))
  
  d1 = do.call(rbind, lapply(pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive] =="NO" & !is.na(pgd_genopheno_01042018[, "sickle"]), cbc_array ], function(x) var.test(x ~ na.omit(pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive] =="NO", "sickle"]))["p.value"]))
  d2 = do.call(rbind, lapply(pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive] =="NO" & !is.na(pgd_genopheno_01042018[, "g6pd_202_rtpcr" ]),cbc_array], function(x) bartlett.test(x ~ na.omit(pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive] =="NO", "g6pd_202_rtpcr"]))["p.value"]))
  d3 = do.call(rbind, lapply(pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive] =="NO" & !is.na(pgd_genopheno_01042018[, "thal" ]),cbc_array], function(x) bartlett.test(x ~ na.omit(pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive] =="NO", "thal"]))["p.value"]))
  d4 = do.call(rbind, lapply(pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive] =="NO" & !is.na(pgd_genopheno_01042018[, "g6pd_202_rtpcr" ]),cbc_array], function(x) fligner.test(x ~ na.omit(pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive] =="NO", "g6pd_202_rtpcr"]))["p.value"]))
  d5 = do.call(rbind, lapply(pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive] =="NO" & !is.na(pgd_genopheno_01042018[, "thal" ]),cbc_array], function(x) fligner.test(x ~ na.omit(pgd_genopheno_01042018[pgd_genopheno_01042018[, malariapositive] =="NO", "thal"]))["p.value"]))
  
  e1 = do.call(rbind, lapply(pgd_genopheno_01042018[pgd_genopheno_01042018[, parasitaemia] =="NO", cbc_array], function(x) shapiro.test(x)["p.value"])) 
  e2 = do.call(rbind, lapply(log10(pgd_genopheno_01042018[pgd_genopheno_01042018[, parasitaemia] =="NO" ,cbc_array]), function(x) shapiro.test(x)["p.value"]))
  e3 = do.call(rbind, lapply(sqrt(pgd_genopheno_01042018[pgd_genopheno_01042018[, parasitaemia] =="NO" ,cbc_array]), function(x) shapiro.test(x)["p.value"]))
  e4 = do.call(rbind, lapply(1/(pgd_genopheno_01042018[pgd_genopheno_01042018[, parasitaemia] =="NO" ,cbc_array]), function(x) shapiro.test(x)["p.value"]))
  
  f1 = do.call(rbind, lapply(pgd_genopheno_01042018[pgd_genopheno_01042018[, parasitaemia] =="NO" & !is.na(pgd_genopheno_01042018[, "sickle"]), cbc_array ], function(x) var.test(x ~ na.omit(pgd_genopheno_01042018[pgd_genopheno_01042018[, parasitaemia] =="NO", "sickle"]))["p.value"]))
  f2 = do.call(rbind, lapply(pgd_genopheno_01042018[pgd_genopheno_01042018[, parasitaemia] =="NO" & !is.na(pgd_genopheno_01042018[, "g6pd_202_rtpcr" ]),cbc_array], function(x) bartlett.test(x ~ na.omit(pgd_genopheno_01042018[pgd_genopheno_01042018[, parasitaemia] =="NO", "g6pd_202_rtpcr"]))["p.value"]))
  f3 = do.call(rbind, lapply(pgd_genopheno_01042018[pgd_genopheno_01042018[, parasitaemia] =="NO" & !is.na(pgd_genopheno_01042018[, "thal" ]),cbc_array], function(x) bartlett.test(x ~ na.omit(pgd_genopheno_01042018[pgd_genopheno_01042018[, parasitaemia] =="NO", "thal"]))["p.value"]))
  f4 = do.call(rbind, lapply(pgd_genopheno_01042018[pgd_genopheno_01042018[, parasitaemia] =="NO" & !is.na(pgd_genopheno_01042018[, "g6pd_202_rtpcr" ]),cbc_array], function(x) fligner.test(x ~ na.omit(pgd_genopheno_01042018[pgd_genopheno_01042018[, parasitaemia] =="NO", "g6pd_202_rtpcr"]))["p.value"]))
  f5 = do.call(rbind, lapply(pgd_genopheno_01042018[pgd_genopheno_01042018[, parasitaemia] =="NO" & !is.na(pgd_genopheno_01042018[, "thal" ]),cbc_array], function(x) fligner.test(x ~ na.omit(pgd_genopheno_01042018[pgd_genopheno_01042018[, parasitaemia] =="NO", "thal"]))["p.value"]))
  
  normality_equalvariance_stats = as.data.frame(cbind(a1,a2,a3,a4,b1,b2,b3,b4,b5,c1,c2,c3,c4,d1,d2,d3,d4,d5,e1,e2,e3,e4,f1,f2,f3,f4,f5))
  colnames(normality_equalvariance_stats) = c('shapiro', 'shapiro_log', 'shapiro_sqrt', 'shapiro_inverse', 'var_sickle', 'bartlett_g6pd', 'bartlett_thal', 'fligner_g6pd', 'fligner_thal', 'shapiro_mn', 'shapiro_log_mn', 'shapiro_sqrt_mn', 'shapiro_inverse_mn', 'var_sickle_mne', 'bartlett_g6pd_mn', 'bartlett_thal_mne', 'fligner_g6pd_mn', 'fligner_thal_mn', 'shapiro_gn', 'shapiro_log_gn', 'shapiro_sqrt_gn', 'shapiro_inverse_gn', 'var_sickle_gn', 'bartlett_g6pd_gn', 'bartlett_thal_gn', 'fligner_g6pd_gn', 'fligner_thal_gn' )
  colnames(normality_equalvariance_stats) = paste('p', colnames(normality_equalvariance_stats), sep = '_')
  eda_pvalues = t(normality_equalvariance_stats)
  }
```

###2010 CBC histograms and boxplots before removal of sicklers
```{r hist_box_plots1, echo=F, message=F, error=F, warning=F,eval=F}
eda_tests(cbc_array = cbc_array_2010, malariapositive = 'uncomplicated_malaria_2010', parasitaemia =  'parasitaemia_2010')
```

###2010 CBC normality and equal variance tests before removal of sicklers
```{r normality_equalvar1, echo=F, eval=F}
panderOptions('table.split.table', Inf)
eda_pvalues = eda_pval(cbc_array = cbc_array_2010, malariapositive = 'uncomplicated_malaria_2010', parasitaemia =  'parasitaemia_2010')
pander(eda_pvalues)
```

###2010 CBC histograms and boxplots after removal of sicklers
```{r hist_box_plots2, echo=F, message=FALSE, error=F, warning=F, results='hide'}
eda_tests(cbc_array = cbc_array_2010, malariapositive = 'uncomplicated_malaria_2010', parasitaemia =  'parasitaemia_2010')
```

###2010 CBC normality and equal variance tests after removal of sicklers
```{r normality_equalvar2, echo=F}
panderOptions('table.split.table', Inf)
eda_pvalues2 = eda_pval(cbc_array = cbc_array_2010, malariapositive = 'uncomplicated_malaria_2010', parasitaemia =  'parasitaemia_2010')
pander(eda_pvalues2)
```

#DATA TABULATION AFTER PRE-PROCESSING

##Tabulating the distribution of gender, age among individuals of the different g6pd_202_rtpcr, thal and sickle genotypes after removal of sicklers

```{r gender&age_tables2, echo=F, eval=F}
panderOptions('table.split.table', Inf)
geno_exp_list_clean = geno_exploration(age_at_collection_years = age_at_collection_years_2010, malariapositive = uncomplicated_malaria_2010, malariapositive1 = "uncomplicated_malaria_2010")
rownames(geno_exp_list_clean[[1]]) = row.names=c("G_all_NM","G_all_HT", "G_all_HM","G_all_sum","T_all_NM","T_all_HT","T_all_HM","T_all_sum","S_all_NM","S_all_HT","S_all_sum","G_mn_NM","G_mn_HT", "G_mn_HM","G_mn_sum","T_mn_NM","T_mn_HT","T_mn_HM","T_mn_sum","S_mn_NM","S_mn_HT","S_mn_sum")
colnames(geno_exp_list_clean[[1]]) = c( "all_F", "all_M", "all_sum", "%dwnF", "%dwnM", "%dwnSum", "%acrsF", "%acrsM", "%acrsSum", "all_G_F", "all_G_M", "all_G_sum", "%G_acrsF", "%G_acrsM", "%G_acrsSum", "%G_dwnF", "%G_dwnM", "%G_dwnSum")
rownames(geno_exp_list_clean[[2]])[1:8] = paste("all", rownames(geno_exp_list_clean[[2]])[1:8], sep = "_")
rownames(geno_exp_list_clean[[2]])[9:16] = paste("all_g6pd", rownames(geno_exp_list_clean[[2]])[9:16], sep = "_")
rownames(geno_exp_list_clean[[2]])[17:24] = paste("mn", rownames(geno_exp_list_clean[[2]])[17:24], sep = "_")
rownames(geno_exp_list_clean[[2]])[25:32] = paste("mn_g6pd" , rownames(geno_exp_list_clean[[2]])[25:32], sep = "_")

rownames(geno_exp_list_clean[[2]])[c(1:3,9:11,17:19,25:27)] = paste("G", rownames(geno_exp_list_clean[[2]])[c(1:3,9:11,17:19,25:27)], sep = "_")
rownames(geno_exp_list_clean[[2]])[c(4:6,12:14,20:22,28:30)] = paste("T", rownames(geno_exp_list_clean[[2]])[c(4:6,12:14,20:22,28:30)], sep = "_")
rownames(geno_exp_list_clean[[2]])[c(7:8,15:16,23:24,31:32)] = paste("S", rownames(geno_exp_list_clean[[2]])[c(7:8,15:16,23:24,31:32)], sep = "_")

rownames(geno_exp_list_clean[[2]]) = paste(rownames(geno_exp_list_clean[[2]]), geno_exp_list_clean[[2]]$g6pd_202_rtpcr, sep = "_")

geno_exp_list_clean[[2]][,"g6pd_202_rtpcr"] = NULL

cat('Gender distribution' )
cat('Key => G=g6pd_202_rtpcr, T=thal, S=sickle, mn=malarianegative, NM=NORM, HT=HET, HM=HOM, M=male, F=female, acrs=across, dwn=down' )
pander(geno_exp_list_clean[1])

cat('Age distribution' )
cat('Key => G=g6pd_202_rtpcr, T=thal, S=sickle, mn=malarianegative, NM=NORM, HT=HET, HM=HOM, M=male, F=female, acrs=across, dwn=down' )
pander(geno_exp_list_clean[2])
```


##Tabulating the distribution of individuals with different g6pd_202_rtpcr, thal and sickle genotypes among those with CBC data after removal of sicklers 

```{r cbc_tables2, echo=F, results='asis',}
panderOptions('table.split.table', Inf)
cbc_exp_list_clean = cbc_exploration(cbc_array = cbc_array_2010, malariapositive = "uncomplicated_malaria_2010")
rownames(cbc_exp_list_clean)[1:11] = paste("all", rownames(cbc_exp_list_clean)[1:11], sep = "_")
rownames(cbc_exp_list_clean)[12:22] = paste("all_g6pd", rownames(cbc_exp_list_clean)[12:22], sep = "_")
rownames(cbc_exp_list_clean)[23:33] = paste("mn", rownames(cbc_exp_list_clean)[23:33], sep = "_")
rownames(cbc_exp_list_clean)[34:44] = paste("mn_g6pd" , rownames(cbc_exp_list_clean)[34:44], sep = "_")

rownames(cbc_exp_list_clean)[c(1:4,12:15,23:26,34:37)] = paste("G", rownames(cbc_exp_list_clean)[c(1:4,12:15,23:26,34:37)], sep = "_")
rownames(cbc_exp_list_clean)[c(5:8,16:19,27:30,38:41)] = paste("T", rownames(cbc_exp_list_clean)[c(5:8,16:19,27:30,38:41)], sep = "_")
rownames(cbc_exp_list_clean)[c(9:11,20:22,31:33,42:44)] = paste("S", rownames(cbc_exp_list_clean)[c(9:11,20:22,31:33,42:44)], sep = "_")

colnames(cbc_exp_list_clean) = cbc_array_2010
pander(cbc_exp_list_clean)
```


##Tabulations

```{r, echo=F, results= 'asis', warning=F, message=F}
panderOptions('knitr.auto.asis', FALSE) 
panderOptions('table.split.table', Inf)

print(shapiro.test(pgd_genopheno_01042018$age_at_collection_years_2010))
print(shapiro.test(pgd_genopheno_01042018$u_rcc))
print(shapiro.test(pgd_genopheno_01042018$u_ghb3))


summary(tableby(formulize('g6pd_202_rtpcr', c("sex",  "malaria_status", "rbc_2010")), data = pgd_genopheno_01042018, numeric.stats = c("Nmiss", "meanCI"), cat.stats=c("Nmiss", "countrowpct")), digits = 2, digits.pct =2, conf.level = 0.95)
summary(tableby(formulize('g6pd_202_rtpcr', c("age_at_collection_years_2010","hgb_2010" , "mcv_2010",  "mch_2010","mchc_2010", "u_rcc", "u_ghb3")), data = pgd_genopheno_01042018, numeric.stats = c("Nmiss", "median", "iqr", "range", "medianmad", "medianq1q3"), numeric.test = "kwt"), digits = 2, digits.pct =2, conf.level = 0.95)
summary(tableby(formulize('sickle', c("sex",  "malaria_status", "rbc_2010")), data = pgd_genopheno_01042018, numeric.stats = c("Nmiss", "meanCI"), cat.stats=c("Nmiss", "countrowpct")), digits = 2, digits.pct =2, conf.level = 0.95)
summary(tableby(formulize('sickle', c("age_at_collection_years_2010", "hgb_2010" , "mcv_2010", "mch_2010", "mchc_2010", "u_rcc", "u_ghb3")), data = pgd_genopheno_01042018, numeric.stats = c("Nmiss", "median", "iqr", "range", "medianmad", "medianq1q3"), numeric.test = "kwt"), digits = 2, digits.pct =2, conf.level = 0.95)
summary(tableby(formulize('thal', c("sex",  "malaria_status", "rbc_2010")), data = pgd_genopheno_01042018, numeric.stats = c("Nmiss", "meanCI"), cat.stats=c("Nmiss", "countrowpct")), digits = 2, digits.pct =2, conf.level = 0.95)
summary(tableby(formulize('thal', c("age_at_collection_years_2010", "hgb_2010" , "mcv_2010", "mch_2010", "mchc_2010", "u_rcc", "u_ghb3")), data = pgd_genopheno_01042018, numeric.stats = c("Nmiss", "median", "iqr", "range", "medianmad", "medianq1q3"), numeric.test = "kwt"), digits = 2, digits.pct =2, conf.level = 0.95)


summary(tableby(interaction(thal, g6pd_202_rtpcr) ~  sex + malaria_status + rbc_2010, data=pgd_genopheno_01042018, numeric.stats = c("Nmiss", "meanCI"), cat.stats=c("Nmiss", "countrowpct")), pfootnote = T, digits = 2, digits.pct =2, conf.level = 0.95)
summary(tableby(interaction(thal, g6pd_202_rtpcr) ~ age_at_collection_years_2010 + hgb_2010  + mcv_2010 + mch_2010 + mchc_2010  + u_rcc + u_ghb3, data = pgd_genopheno_01042018, numeric.stats = c("Nmiss", "median", "iqr", "range", "medianmad", "medianq1q3"), numeric.test = "kwt"), pfootnote = T, digits = 2, digits.pct =2, conf.level = 0.95)

summary(tableby(interaction(sickle, g6pd_202_rtpcr) ~  sex + malaria_status + rbc_2010, data=pgd_genopheno_01042018, numeric.stats = c("Nmiss", "meanCI"), cat.stats=c("Nmiss", "countrowpct")), pfootnote = T, digits = 2, digits.pct =2, conf.level = 0.95)
summary(tableby(interaction(sickle, g6pd_202_rtpcr) ~ age_at_collection_years_2010 + hgb_2010  + mcv_2010 + mch_2010 + mchc_2010 + u_rcc + u_ghb3, data = pgd_genopheno_01042018, numeric.stats = c("Nmiss", "median", "iqr", "range", "medianmad", "medianq1q3"), numeric.test = "kwt"), pfootnote = T, digits = 2, digits.pct =2, conf.level = 0.95)
```

##2010 age and CBC summary (mean, sd, median) by rbc polymorphisms
```{r 2010_cbc_summary, results='asis', echo=F}
panderOptions('table.split.table', Inf)
cat("<B><U>CBC summary in all individuals by rbc polymorphisms</U></B> \n")
se <- function(x, na.rm=FALSE) {
  if (na.rm) x <- na.omit(x)
  sqrt(var(x)/length(x))
}

pander(pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr)) %>% group_by(g6pd_202_rtpcr) %>% summarise_at(vars(cbc_array_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
pander(pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr)) %>% group_by(thal) %>% summarise_at(vars(cbc_array_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
pander(pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr)) %>% group_by(sickle) %>% summarise_at(vars(cbc_array_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
pander(pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr)& !is.na(thal)) %>% group_by(g6pd_202_rtpcr, thal) %>% summarise_at(vars(cbc_array_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
pander(pgd_genopheno_01042018 %>% filter(!is.na(g6pd_202_rtpcr)&!is.na(sickle)) %>% group_by(g6pd_202_rtpcr, sickle) %>% summarise_at(vars(cbc_array_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())

cat("<B><U>CBC and enzyme activity summary in all individuals by sex</U></B> \n")
pander(pgd_genopheno_01042018 %>% filter(!is.na(sex)) %>% group_by(sex) %>% summarise_at(vars(cbc_array_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())

pander(pgd_genopheno_01042018 %>% filter(!is.na(sex) & u_ghb3 > 0) %>% group_by(sex) %>% summarise_at(vars(ed), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())


cat("<B><U>enzyme activity summary in all individuals by rbc polymorphisms</U></B> \n")
pander(pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr) & u_ghb3 > 0) %>% group_by(g6pd_202_rtpcr) %>% summarise_at(vars(ed), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
pander(pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr ) & u_ghb3 > 0) %>% group_by(thal) %>% summarise_at(vars(ed), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
pander(pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr) & u_ghb3 > 0) %>% group_by(sickle) %>% summarise_at(vars(ed), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
pander(pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr)& !is.na(thal) & u_ghb3 > 0) %>% group_by(g6pd_202_rtpcr, thal) %>% summarise_at(vars(ed), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
pander(pgd_genopheno_01042018 %>% filter(!is.na(g6pd_202_rtpcr)&!is.na(sickle) & u_ghb3 > 0) %>% group_by(g6pd_202_rtpcr, sickle) %>% summarise_at(vars(ed), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())

#pander(pgd_genopheno_01042018 %>% filter(!is.na(sickle)) %>% group_by(sickle) %>% summarise_at(vars(cbc_array_2010), funs(mean(.,na.rm = T),sd(., na.rm = T), median(., na.rm = T))) %>% t())

cat(" \n <B><U>Age summary in all individuals by rbc polymorphisms</U></B> \n")
pander(pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr) & !is.na(thal)) %>% group_by(g6pd_202_rtpcr, thal) %>% summarise_at(vars(age_at_collection_years_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T),gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T),  min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr) & !is.na(sickle)) %>% group_by(g6pd_202_rtpcr, thal) %>% summarise(n=n()) %>% pander()

pander(pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr)&!is.na(sickle)) %>% group_by(g6pd_202_rtpcr, sickle) %>% summarise_at(vars(age_at_collection_years_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T),gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T),  min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())

pander(pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr)) %>% group_by(g6pd_202_rtpcr)%>% summarise_at(vars(age_at_collection_years_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T),gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T),  min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
pander(pgd_genopheno_01042018 %>% filter( !is.na(thal)) %>% group_by(thal) %>% summarise_at(vars(age_at_collection_years_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T),gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T),  min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
pander(pgd_genopheno_01042018 %>% filter( !is.na(sickle)) %>% group_by(sickle)%>% summarise_at(vars(age_at_collection_years_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T),gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T),  min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())

pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr) & !is.na(sickle)) %>% group_by(g6pd_202_rtpcr, sickle) %>% summarise(n=n()) %>% pander()

cat(" \n <B><U>Age summary in individuals with g6pd activity by rbc polymorphisms</U></B> \n")
pander(pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr) & !is.na(thal) & !is.na(u_ghb3)) %>% group_by(g6pd_202_rtpcr, thal) %>% summarise_at(vars(age_at_collection_years_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr)&!is.na(sickle) & !is.na(u_ghb3)) %>% group_by(g6pd_202_rtpcr, thal) %>% summarise(n=n()) %>% pander()

pander(pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr) & !is.na(sickle) & !is.na(u_ghb3)) %>% group_by(g6pd_202_rtpcr, sickle) %>% summarise_at(vars(age_at_collection_years_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr) & !is.na(sickle) & !is.na(u_ghb3)) %>% group_by(g6pd_202_rtpcr, sickle) %>% summarise(n=n()) %>% pander()
#pander(pgd_genopheno_01042018 %>% filter( !is.na(sickle)) %>% group_by(sickle) %>% summarise_at(vars(age_at_collection_months_2010), funs(mean(.,na.rm = T),sd(., na.rm = T), median(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())

cat(" \n <B><U>CBC summary in malarianegative individuals</U></B> \n")
pander(pgd_genopheno_01042018 %>% filter(uncomplicated_malaria_2010 == "NO" & !is.na(g6pd_202_rtpcr)) %>% group_by(g6pd_202_rtpcr) %>% summarise_at(vars(cbc_array_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
pander(pgd_genopheno_01042018 %>% filter(uncomplicated_malaria_2010 == "NO" & !is.na(thal)) %>% group_by(thal) %>% summarise_at(vars(cbc_array_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
pander(pgd_genopheno_01042018 %>% filter(uncomplicated_malaria_2010 == "NO" & !is.na(sickle)) %>% group_by(sickle) %>% summarise_at(vars(cbc_array_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), gmean=Gmean(., conf.level = 0.95, na.rm = T)[1],lci=Gmean(., conf.level = 0.95, na.rm = T)[2],uci=Gmean(., conf.level = 0.95, na.rm = T)[3],Gsd(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
pander(pgd_genopheno_01042018 %>% filter(uncomplicated_malaria_2010 == "NO" & !is.na(g6pd_202_rtpcr)) %>% group_by(g6pd_202_rtpcr) %>% summarise_at(vars(age_at_collection_months_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), min(., na.rm = T), max(., na.rm = T), IQR(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
pander(pgd_genopheno_01042018 %>% filter(uncomplicated_malaria_2010 == "NO" & !is.na(thal)) %>% group_by(thal) %>% summarise_at(vars(age_at_collection_months_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), min(., na.rm = T), max(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
pander(pgd_genopheno_01042018 %>% filter(uncomplicated_malaria_2010 == "NO" & !is.na(sickle)) %>% group_by(sickle) %>% summarise_at(vars(age_at_collection_months_2010), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), min(., na.rm = T), max(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
pander(pgd_genopheno_01042018 %>% filter(uncomplicated_malaria_2010 == "NO" & !is.na(sickle)) %>% group_by(sickle) %>% summarise_at(vars(u_ghb3), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), min(., na.rm = T), max(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
pander(pgd_genopheno_01042018 %>% filter(uncomplicated_malaria_2010 == "NO" & !is.na(sickle)) %>% group_by(sickle) %>% summarise_at(vars(u_rcc), funs(mean(.,na.rm = T), se=se(., na.rm = T),sd(., na.rm = T), median(., na.rm = T), min(., na.rm = T), max(., na.rm = T), q25=quantile(., probs = 0.25,na.rm = T ), q75=quantile(., probs = 0.75,na.rm = T ))) %>% t())
cat(" \n \n")
```

##2011 age and CBC summary (mean, sd, median) by rbc polymorphisms
```{r 2011_cbc_summary, echo=F, eval=F}
panderOptions('table.split.table', Inf)
pander(pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr)) %>% group_by(g6pd_202_rtpcr) %>% summarise_at(vars(cbc_array_2011), funs(mean(.,na.rm = T),sd(., na.rm = T), median(., na.rm = T))) %>% t())
pander(pgd_genopheno_01042018 %>% filter(  !is.na(thal)) %>% group_by(thal) %>% summarise_at(vars(cbc_array_2011), funs(mean(.,na.rm = T),sd(., na.rm = T), median(., na.rm = T))) %>% t())
pander(pgd_genopheno_01042018 %>% filter( !is.na(sickle)) %>% group_by(sickle) %>% summarise_at(vars(cbc_array_2011), funs(mean(.,na.rm = T),sd(., na.rm = T), median(., na.rm = T))) %>% t())
```

##Tabulating the number of individuals with the different genotype combinations including and excluding malariapositive individuals
```{r genotype_combinations, echo=F}

cat("<B><U>g6pd_202_rtpcr by HbS genotypes in all individuals</U></B> \n")
lapply(pgd_genopheno_01042018[, cbc_array_2010], function(x) addmargins(table(pgd_genopheno_01042018[!is.na(x), c("sickle", "g6pd_202_rtpcr")], useNA = "ifany")))
cat("<B><U>g6pd_202_rtpcr by thal genotypes in all individuals</U></B> \n")
lapply(pgd_genopheno_01042018[, cbc_array_2010], function(x) addmargins(table(pgd_genopheno_01042018[!is.na(x), c("thal", "g6pd_202_rtpcr")], useNA = "ifany")))
cat("<B><U>g6pd_202_rtpcr by thal genotypes in all individuals</U></B> \n")
pgd_genopheno_01042018 %>% filter( !is.na(thal) & !is.na(g6pd_202_rtpcr)) %>% with(pander(addmargins(table(thal, g6pd_202_rtpcr))))
cat("<B><U>g6pd_202_rtpcr by HBS genotypes in all individuals</U></B> \n")
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(g6pd_202_rtpcr)) %>% with(pander(addmargins(table(sickle, g6pd_202_rtpcr))))
cat("<B><U>thal by HbS genotypes in all individuals</U></B> \n")
pgd_genopheno_01042018 %>% filter(!is.na(sickle) & !is.na(thal)) %>% with(pander(addmargins(table(sickle, thal))))

cat("<B><U>combinations of g6pd_202_rtpcr, thal and HbS genotypes in all individuals</U></B> \n")
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr)) %>% group_by(g6pd_202_rtpcr, thal, sickle) %>% summarise(n=n()) %>% pander() 
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(sex)) %>% group_by(g6pd_202_rtpcr, thal, sickle, sex) %>% summarise(n=n()) %>% pander()
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(malaria_status)) %>% group_by(g6pd_202_rtpcr, thal, sickle, malaria_status) %>% summarise(n=n()) %>% pander()
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(u_ghb3)) %>% group_by(g6pd_202_rtpcr, thal, sickle) %>% summarise(n=n()) %>% pander()

pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr)) %>% group_by(g6pd_202_rtpcr, thal) %>% summarise(n=n()) %>% pander()
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(sex)) %>% group_by(g6pd_202_rtpcr, thal, sex) %>% summarise(n=n()) %>% pander()
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(malaria_status)) %>% group_by(g6pd_202_rtpcr, thal, malaria_status) %>% summarise(n=n()) %>% pander()
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(u_ghb3)) %>% group_by(g6pd_202_rtpcr, thal) %>% summarise(n=n()) %>% pander()

pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr)) %>% group_by(g6pd_202_rtpcr, sickle) %>% summarise(n=n()) %>% pander()
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(malaria_status)) %>% group_by(g6pd_202_rtpcr, sickle, malaria_status) %>% summarise(n=n()) %>% pander()
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(sex)) %>% group_by(g6pd_202_rtpcr, sickle, sex) %>% summarise(n=n()) %>% pander()
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(u_ghb3)) %>% group_by(g6pd_202_rtpcr, sickle) %>% summarise(n=n()) %>% pander()

cat("<B><U>g6pd_202_rtpcr, thal and HbS genotypes by sex and malaria status</U></B> \n")
pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr) & !is.na(malaria_status)) %>% group_by(g6pd_202_rtpcr, malaria_status) %>% summarise(n=n()) %>% pander()
pgd_genopheno_01042018 %>% filter( !is.na(g6pd_202_rtpcr) & !is.na(sex)) %>% group_by(g6pd_202_rtpcr, sex) %>% summarise(n=n()) %>% pander()

pgd_genopheno_01042018 %>% filter( !is.na(sickle)  & !is.na(malaria_status)) %>% group_by(sickle, malaria_status) %>% summarise(n=n()) %>% pander()
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(sex)) %>% group_by(sickle, sex) %>% summarise(n=n()) %>% pander()

pgd_genopheno_01042018 %>% filter( !is.na(thal) & !is.na(malaria_status)) %>% group_by(thal, malaria_status) %>% summarise(n=n()) %>% pander()
pgd_genopheno_01042018 %>% filter( !is.na(thal) & !is.na(sex)) %>% group_by(thal, sex) %>% summarise(n=n()) %>% pander()


cat("<B><U>combinations of g6pd_202_rtpcr, thal and HbS genotypes in individuals with g6pd activity</U></B> \n")
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(u_ghb3)) %>% group_by(g6pd_202_rtpcr, thal, sickle) %>% summarise(n=n()) %>% pander() 
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(sex) & !is.na(u_ghb3)) %>% group_by(g6pd_202_rtpcr, thal, sickle, sex) %>% summarise(n=n()) %>% pander()
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(malaria_status) & !is.na(u_ghb3)) %>% group_by(g6pd_202_rtpcr, thal, sickle, malaria_status) %>% summarise(n=n()) %>% pander()

pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(u_ghb3)) %>% group_by(g6pd_202_rtpcr, thal) %>% summarise(n=n()) %>% pander()
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(sex) & !is.na(u_ghb3)) %>% group_by(g6pd_202_rtpcr, thal, sex) %>% summarise(n=n()) %>% pander()
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(malaria_status) & !is.na(u_ghb3)) %>% group_by(g6pd_202_rtpcr, thal, malaria_status) %>% summarise(n=n()) %>% pander()

pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(u_ghb3)) %>% group_by(g6pd_202_rtpcr, sickle) %>% summarise(n=n()) %>% pander()
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(malaria_status) & !is.na(u_ghb3)) %>% group_by(g6pd_202_rtpcr, sickle, malaria_status) %>% summarise(n=n()) %>% pander()
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(sex) & !is.na(u_ghb3)) %>% group_by(g6pd_202_rtpcr, sickle, sex) %>% summarise(n=n()) %>% pander()


cat("<B><U>g6pd_202_rtpcr by HbS genotypes in malaria negative individuals</U></B> \n")
pgd_genopheno_01042018 %>% filter(  uncomplicated_malaria_2010 == "NO" & !is.na(sickle) & !is.na(g6pd_202_rtpcr)) %>% with(pander(addmargins(table(sickle, g6pd_202_rtpcr))))
cat("<B><U>g6pd_202_rtpcr by thal genotypes in malaria negative individuals</U></B> \n")
pgd_genopheno_01042018 %>% filter(  uncomplicated_malaria_2010 == "NO" & !is.na(thal) & !is.na(g6pd_202_rtpcr)) %>% with(pander(addmargins(table(thal, g6pd_202_rtpcr))))
cat("<B><U>thal by HbS genotypes in malaria negative individuals</U></B> \n")
pgd_genopheno_01042018 %>% filter(  uncomplicated_malaria_2010 == "NO" & !is.na(sickle) & !is.na(thal)) %>% with(pander(addmargins(table(sickle, thal))))
cat("<B><U>combinations of g6pd_202_rtpcr, thal and HbS genotypes in malaria negative individuals</U></B> \n")
pgd_genopheno_01042018 %>% filter(  uncomplicated_malaria_2010 == "NO" & !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr)) %>% group_by(g6pd_202_rtpcr, thal, sickle) %>% summarise(n=n()) %>% pander()

cat("<B><U>g6pd_202_rtpcr by thal genotypes in all individuals with enzyme activity</U></B> \n")
pgd_genopheno_01042018 %>% filter( !is.na(thal) & !is.na(g6pd_202_rtpcr)  & !is.na(u_ghb3)) %>% with(pander(addmargins(table(thal, g6pd_202_rtpcr))))
cat("<B><U>g6pd_202_rtpcr by HBS genotypes in all individuals with enzyme activity</U></B> \n")
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(g6pd_202_rtpcr) & !is.na(u_ghb3)) %>% with(pander(addmargins(table(sickle, g6pd_202_rtpcr))))
cat("<B><U>thal by HbS genotypes in all individuals with enzyme activity</U></B> \n")
pgd_genopheno_01042018 %>% filter(!is.na(sickle) & !is.na(thal) & !is.na(u_ghb3)) %>% with(pander(addmargins(table(sickle, thal))))
cat("<B><U>combinations of g6pd_202_rtpcr, thal and HbS genotypes in all individuals with enzyme activity</U></B> \n")
pgd_genopheno_01042018 %>% filter( !is.na(sickle) & !is.na(thal) & !is.na(g6pd_202_rtpcr) & !is.na(u_ghb3)) %>% group_by(g6pd_202_rtpcr, thal, sickle) %>% summarise(n=n()) %>% pander()

##list of individuals classified as normal based on the G6PD202 genotype but appear deficient based on the ughb3 phenotype and vice versa
u_ghb3_gtype_norm_ptype_def_norm = pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb3"] > 15 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM",]
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb3"] > 15 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "hgb_2010"]))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb3"] < 15 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "hgb_2010"]))
print(kruskal.test(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_ghb3"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "hgb_2010"] ~ pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_ghb3"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "u_ghb3"] > 15))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb3"] > 15 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "g6p_odmin"]))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb3"] < 15 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "g6p_odmin"]))
print(kruskal.test(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_ghb3"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "g6p_odmin"] ~ pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_ghb3"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "u_ghb3"] > 15))
print(table(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_ghb3"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "u_ghb3"] > 15))
write.csv(u_ghb3_gtype_norm_ptype_def_norm, "C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/Regenotyping/u_ghb3_gtype_norm_ptype_def_norm.csv", quote = F, row.names = F)

u_ghb3_gtype_norm_ptype_def_het = pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb3"] > 11 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET",]
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb3"] > 11 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "hgb_2010"]))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb3"] < 11 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "hgb_2010"]))
print(kruskal.test(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_ghb3"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "hgb_2010"] ~ pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_ghb3"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "u_ghb3"] > 11))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb3"] > 11 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "g6p_odmin"]))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb3"] < 11 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "g6p_odmin"]))
print(kruskal.test(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_ghb3"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "g6p_odmin"] ~ pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_ghb3"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "u_ghb3"] > 11))
print(table(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_ghb3"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "u_ghb3"] > 11))
write.csv(u_ghb3_gtype_norm_ptype_def_het, "C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/Regenotyping/u_ghb3_gtype_norm_ptype_def_het.csv", quote = F, row.names = F)

u_ghb3_gtype_norm_ptype_def_hom = pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb3"] > 2.5 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI",]
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb3"] > 2.5 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI", "hgb_2010"]))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb3"] < 2.5 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI", "hgb_2010"]))
print(kruskal.test(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_ghb3"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI", "hgb_2010"] ~ pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_ghb3"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI", "u_ghb3"] > 2.5))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb3"] > 2.5 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI", "g6p_odmin"]))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_ghb3"] < 2.5 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI", "g6p_odmin"]))
print(kruskal.test(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_ghb3"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI", "g6p_odmin"] ~ pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_ghb3"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI", "u_ghb3"] > 2.5))
print(table(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_ghb3"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI","u_ghb3"] > 2.5))
write.csv(u_ghb3_gtype_norm_ptype_def_hom, "C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/Regenotyping/u_ghb3_gtype_norm_ptype_def_hom.csv", quote = F, row.names = F)

##list of individuals classified as normal based on the G6PD202 genotype but appear deficient based on the urcc phenotype and vice versa
u_rcc_gtype_norm_ptype_def_norm = pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_rcc"] > 350 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM",]
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_rcc"] > 350 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "rbc_2010"]))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_rcc"] < 350 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "rbc_2010"]))
print(kruskal.test(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_rcc"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "rbc_2010"] ~ pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_rcc"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "u_rcc"] > 350))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_rcc"] > 350 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "g6p_odmin"]))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_rcc"] < 350 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "g6p_odmin"]))
print(kruskal.test(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_rcc"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "g6p_odmin"] ~ pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_rcc"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "u_rcc"] > 350))
print(table(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_rcc"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "u_rcc"] > 350))
write.csv(u_rcc_gtype_norm_ptype_def_norm, "C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/Regenotyping/u_rcc_gtype_norm_ptype_def_norm.csv", quote = F, row.names = F)

u_rcc_gtype_norm_ptype_def_het = pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_rcc"] > 300 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET",]
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_rcc"] > 300 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "rbc_2010"]))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_rcc"] < 300 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "rbc_2010"]))
print(kruskal.test(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_rcc"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "rbc_2010"] ~ pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_rcc"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "u_rcc"] > 300))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_rcc"] > 300 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "g6p_odmin"]))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_rcc"] < 300 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "g6p_odmin"]))
print(kruskal.test(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_rcc"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "g6p_odmin"] ~ pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_rcc"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "u_rcc"] > 300))
print(table(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_rcc"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "u_rcc"] > 300))
write.csv(u_rcc_gtype_norm_ptype_def_het, "C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/Regenotyping/u_rcc_gtype_norm_ptype_def_het.csv", quote = F, row.names = F)

u_rcc_gtype_norm_ptype_def_hom = pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_rcc"] > 100 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI",]
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_rcc"] > 100 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI", "rbc_2010"]))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_rcc"] < 100 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI", "rbc_2010"]))
print(kruskal.test(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_rcc"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI", "rbc_2010"] ~ pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_rcc"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI", "u_rcc"] > 100))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_rcc"] > 100 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI", "g6p_odmin"]))
print(summary(pgd_genopheno_01042018[pgd_genopheno_01042018[,"u_rcc"] < 100 & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI", "g6p_odmin"]))
print(kruskal.test(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_rcc"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI", "g6p_odmin"] ~ pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_rcc"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI", "u_rcc"] > 100))
print(table(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"u_rcc"]) & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HOM/HEMI", "u_rcc"] > 100))
write.csv(u_rcc_gtype_norm_ptype_def_hom, "C:/Users/Jesse Rop/OneDrive - Kemri Wellcome Trust/WT 18 month project/PGD datasets and analysis/Regenotyping/u_rcc_gtype_norm_ptype_def_hom.csv", quote = F, row.names = F)
```


#ASSOCIATION TESTS

##2010 Age and CBC differences as measured by kruskal  walis and chisqr between the various genotype groups


```{r chi_sqr, echo=F}

pander(lapply(pgd_genopheno_01042018[,rbc_polymorphism], function(x) kruskal.test(pgd_genopheno_01042018[,"age_at_collection_months_2010"] ~ x)))
cat(" \n minus uncomplicated malaria cases \n")       
pander(lapply(pgd_genopheno_01042018[pgd_genopheno_01042018[, "uncomplicated_malaria_2010"] =="NO" & !is.na(pgd_genopheno_01042018[, rbc_polymorphism ]),rbc_polymorphism], function(x) kruskal.test(pgd_genopheno_01042018[pgd_genopheno_01042018[, "uncomplicated_malaria_2010"] =="NO"& !is.na(pgd_genopheno_01042018[, rbc_polymorphism ]), "age_at_collection_months_2010"] ~ x)))

cat("G6PD202 and Thal combination (contigency table) \n") 
pgd_genopheno_01042018 %>% filter(!is.na(g6pd_202_rtpcr) & !is.na(thal)) %>% with(table(g6pd_202_rtpcr, thal)) %>% chisq.test() %>% pander(add.significance.stars = T)
cat("G6PD202 and sickle combination (contigency table) \n") 
pgd_genopheno_01042018 %>% filter(!is.na(g6pd_202_rtpcr) & !is.na(sickle)) %>% with(table(g6pd_202_rtpcr, sickle)[,-3]) %>% chisq.test() %>% pander(add.significance.stars = T)
cat("Thal and sickle combination (contigency table) \n") 
pgd_genopheno_01042018 %>% filter(!is.na(thal) & !is.na(sickle)) %>% with(table(thal, sickle)[,-3]) %>% chisq.test() %>% pander(add.significance.stars = T)

cat("G6PD202 and Thal combination (contigency table) \n") 
pgd_genopheno_01042018 %>% filter(  uncomplicated_malaria_2010 == "NO" & !is.na(g6pd_202_rtpcr) & !is.na(thal)) %>% with(table(g6pd_202_rtpcr, thal)) %>% chisq.test() %>% pander(add.significance.stars = T)
cat("G6PD202 and sickle combination (contigency table) \n") 
pgd_genopheno_01042018 %>% filter(  uncomplicated_malaria_2010 == "NO" & !is.na(g6pd_202_rtpcr) & !is.na(sickle)) %>% with(table(g6pd_202_rtpcr, sickle)[,-3]) %>% chisq.test() %>% pander(add.significance.stars = T)
cat("Thal and sickle combination (contigency table) \n") 
pgd_genopheno_01042018 %>% filter(  uncomplicated_malaria_2010 == "NO" & !is.na(thal) & !is.na(sickle)) %>% with(table(thal, sickle)[,-3]) %>% chisq.test() %>% pander(add.significance.stars = T)
cat("association between malaria status and rbc polymorphism and cbc indices \n") 
pander(lapply(pgd_genopheno_01042018[, rbc_polymorphism], function(x) chisq.test(pgd_genopheno_01042018$malaria_status, x)))
pander(lapply(pgd_genopheno_01042018[, cbc_array_2010], function(x) kruskal.test(x ~ pgd_genopheno_01042018[,"malaria_status"])))

```

##Univariate association tests (each cbc trait versus each polymorphism)  

```{r, echo=F, results='asis', warning=F}
panderOptions('knitr.auto.asis', FALSE) 
panderOptions('table.split.table', Inf)
pgd_cbc_vs_rbcpol_univariate_pairwise_all_individuals = function(cbc_array, age_at_collection_years) {

for (i in 1:length(rbc_polymorphism)) {

  cat('###', rbc_polymorphism[i] ,'++++', rbc_polymorphism[i], ' {.tabset}', ' \n')

  for (j in 1:length(cbc_array)) {
    cat("####",cbc_array[j]," \n")
    b = pgd_genopheno_01042018[ , c (rbc_polymorphism[i], cbc_array[j], age_at_collection_years, "u_ghb3", "sex")]
    
    cat(" \n pairwise t.test_____________________________________________________________ \n ")
    ##pairwise t.test for the differences in cbc traits by each of the rbc polymorphisms using holms, bonferroni and fdr pvalue adjustment methods
    pander(pairwise.t.test(b[,cbc_array[j]], b[,rbc_polymorphism[i]]),add.significance.stars = T)
    
    cat(" \n tukeyHSD____________________________________________________________________ \n ")
    ##tukeyHSD for comparison of each cbc traits between all possible groups per rbc polmorphism
    pander(TukeyHSD(aov(b[,cbc_array[j]] ~ b[,rbc_polymorphism[i]])),add.significance.stars = T)
    
    cat(" \n kruskal.test________________________________________________________________ \n")
    ##kruskal.test for comparison of each cbc trait between all possible groups per rbc polmorphism
    pander(kruskal.test(b[,cbc_array[j]] ~ b[,rbc_polymorphism[i]]),add.significance.stars = T)
    
    cat(" \n Oneway anova________________________________________________________________ \n")
    ##Oneway anova test to check whether there is any significant difference in the cbc traits by the genotypes in each rbc polymorphisms
    ##Doesn't assume equal variances thus p value might be lower than that obtained from a linear regression
    pander(oneway.test(b[,cbc_array[j]] ~ b[,rbc_polymorphism[i]]),add.significance.stars = T)
    
  }
}
}

pgd_cbc_vs_rbcpol_univariate_pairwise_all_individuals(cbc_array = cbc_array_2010, age_at_collection_years = 'age_at_collection_years_2010')
```

##Univariate association of CBC traits with sex, malaria and age {.tabset}

Testing for the proportion of variability in the RBC CBC indices that is accounted for by different measured factors

```{r, echo=F, results= 'asis', warning=F}
panderOptions('knitr.auto.asis', FALSE) 
panderOptions('table.split.table', Inf)
pgd_cbc_vs_rbcpol_mvrt_rgrs = function(cbc_array, malariapositive, age_at_collection_years) {
  for (j in 1:length(cbc_array)) {
    cat('###',cbc_array[j], ' \n')
    
    b = pgd_genopheno_01042018[ , c (rbc_polymorphism, age_at_collection_years, "sex", malariapositive, "ethnic", cbc_array[j])]
    
    #cat("tukeyHSD____________________________________________________________ \n")
    ##tukeyHSD for comparison of each cbc trait between all possible groups per rbc polmorphism
    #pander(TukeyHSD(aov(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(4,length(b))]), collapse = "+") )), data = b)),add.significance.stars = T)

    cat("lm__________________________________________________________________ \n")
    ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
    pander(summary(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[4] )), data = b)),add.significance.stars = T)
    pander(confint(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[4] )), data = b), level = 0.95))
    pander(summary(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[5] )), data = b)),add.significance.stars = T)
    pander(confint(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[5] )), data = b), level = 0.95))
    pander(summary(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[6] )), data = b)),add.significance.stars = T)
    pander(summary(lm(as.formula(paste(cbc_array[j], "~", colnames(b)[7] )), data = b)),add.significance.stars = T)

    cat(' \n \n')
 
  }
}
pgd_cbc_vs_rbcpol_mvrt_rgrs(cbc_array= cbc_array_2010, malariapositive= 'malaria_status', age_at_collection_years = 'age_at_collection_years_2010')
```


##Multivariate wambua {.tabset}

```{r, echo=F, results= 'asis', warning=F}
panderOptions('knitr.auto.asis', FALSE) 
panderOptions('table.split.table', Inf)

pgd_cbc_vs_rbcpol_wambua = function(cbc_array, malariapositive, age_at_collection_years, gtype = c("NORM","HET","HOM", "HOM/HEMI")) {

    for (j in 1:length(cbc_array)) {
    
      cat('###',cbc_array[j], ' \n')
          
      
      
      b = pgd_genopheno_01042018[, c (rbc_polymorphism, age_at_collection_years, "sex", cbc_array[j])]
  
      cat("####All_vs_g6pd+thal________________________________________________________________ \n")
       ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait not accounting for age and sex
      pander(summary(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(3,4,5,length(b))]), collapse = "+") )), data = b)),add.significance.stars = T)
      pander(confint(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(3,4,5,length(b))]), collapse = "+") )), data = b), level=0.95))
      pander(kable(emmeans(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(3,4,5,length(b))]), collapse = "+") )), data = b) , "g6pd_202_rtpcr", by = c("thal") )))
      pander(b %>% filter(!is.na(!!cbc_array_q_2010[[j]]) & !is.na(g6pd_202_rtpcr) & !is.na(thal) & !is.na(sickle)) %>% count(g6pd_202_rtpcr,thal))
              
      ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
      par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
      plot(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(3,4,5,length(b))]), collapse = "+") )), data = b))
      cat(' \n \n')
           
      ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait accounting for age
      pander(summary(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(3,5,length(b))]), collapse = "+") )), data = b)),add.significance.stars = T)
      pander(confint(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(3,5,length(b))]), collapse = "+") )), data = b), level=0.95))
      pander(kable(emmeans(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(3,5,length(b))]), collapse = "+") )), data = b) , "g6pd_202_rtpcr", by = c("thal" ) )))
      pander(b %>% filter(!is.na(!!cbc_array_q_2010[[j]]) & !is.na(!!age_at_collection_years) & !is.na(g6pd_202_rtpcr) & !is.na(thal) ) %>% count(g6pd_202_rtpcr,thal))
              
      ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
      par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
      plot(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(3,5,length(b))]), collapse = "+") )), data = b))
      cat(' \n \n')
      

      
      cat("####All_vs_g6pd+sickle________________________________________________________________ \n")
 
      ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait not accounting for age and sex
      pander(summary(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(2,4,5,length(b))]), collapse = "+") )), data = b)),add.significance.stars = T)
      pander(confint(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(2,4,5,length(b))]), collapse = "+") )), data = b), level=0.95))
      pander(kable(emmeans(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(2,4,5,length(b))]), collapse = "+") )), data = b) , "g6pd_202_rtpcr", by = c("sickle") )))
      pander(b %>% filter(!is.na(!!cbc_array_q_2010[[j]]) & !is.na(g6pd_202_rtpcr) & !is.na(thal) & !is.na(sickle)) %>% count(g6pd_202_rtpcr,sickle))
      ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
      par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
      plot(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(3,4,5,length(b))]), collapse = "+") )), data = b))
      cat(' \n \n')

      ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait accounting for age
      pander(summary(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(2,5,length(b))]), collapse = "+") )), data = b)),add.significance.stars = T)
      pander(confint(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(2,5,length(b))]), collapse = "+") )), data = b), level=0.95))
      pander(kable(emmeans(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(2,5,length(b))]), collapse = "+") )), data = b) , "g6pd_202_rtpcr", by = c("sickle" ) )))
      pander(b %>% filter(!is.na(!!cbc_array_q_2010[[j]]) & !is.na(!!age_at_collection_years) & !is.na(g6pd_202_rtpcr) & !is.na(thal) ) %>% count(g6pd_202_rtpcr,sickle))
      ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
      par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
      plot(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(2,5,length(b))]), collapse = "+") )), data = b))
      cat(' \n \n')
       
      ##Looping through different rbc polymorphisms to stratify analysis by this
      for (k in 1:length(rbc_polymorphism)){
      pander(summary(lm(as.formula(paste(cbc_array[j], "~", paste(rbc_polymorphism[k]) )), data = pgd_genopheno_01042018)),add.significance.stars = T)
      pander(confint(lm(as.formula(paste(cbc_array[j], "~", paste(rbc_polymorphism[k]) )), data = pgd_genopheno_01042018), level=0.95))
      
      pander(summary(lm(as.formula(paste(cbc_array[j], "~", paste(rbc_polymorphism[k], "+", age_at_collection_years) )), data = pgd_genopheno_01042018)),add.significance.stars = T)
      pander(confint(lm(as.formula(paste(cbc_array[j], "~", paste(rbc_polymorphism[k], "+", age_at_collection_years) )), data = pgd_genopheno_01042018), level=0.95))
  
        
        for (l in 1:length(gtype)){    
          b = pgd_genopheno_01042018[ pgd_genopheno_01042018[,rbc_polymorphism[k]] == gtype[l], c (rbc_polymorphism[-k], age_at_collection_years, "sex", cbc_array[j])]
          cat(paste( rbc_polymorphism[k], "_", gtype[l], "________________________________________________________________ "))
          cat(' \n')
           tryCatch({
          ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
          pander(summary(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),2,4,5)]), collapse = "+") )), data = b)),add.significance.stars = T)
          pander(confint(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),2,4,5)]), collapse = "+") )), data = b), level=0.95))
          pander(kable(emmeans(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),2,4,5)]), collapse = "+") )), data = b) , rbc_polymorphism[-k][1] )))
          pander(b %>% filter(!is.na(!!cbc_array_q_2010[[j]]) & !is.na(!!age_at_collection_years) & !is.na(!!rbc_polymorphism_q[-k][[1]])) %>% count(!!rbc_polymorphism_q[-k][[1]]))

          ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
          par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
          plot(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),2,4,5)]), collapse = "+") )), data = b))
          cat(' \n \n')
          
          ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
          pander(summary(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),2,3,4,5)]), collapse = "+") )), data = b)),add.significance.stars = T)
          pander(confint(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),2,3,4,5)]), collapse = "+") )), data = b), level=0.95))
          pander(kable(emmeans(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),2,3,4,5)]), collapse = "+") )), data = b) , rbc_polymorphism[-k][1] )))
          pander(b %>% filter(!is.na(!!cbc_array_q_2010[[j]]) & !is.na(!!age_at_collection_years) & !is.na(!!rbc_polymorphism_q[-k][[1]])) %>% count(!!rbc_polymorphism_q[-k][[1]]))

          ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
          par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
          plot(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),2,3,4,5)]), collapse = "+") )), data = b))
          cat(' \n \n')
           }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
          
          tryCatch({
          ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
          pander(summary(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),1,4,5)]), collapse = "+") )), data = b)),add.significance.stars = T)
          pander(confint(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),1,4,5)]), collapse = "+") )), data = b), level=0.95))
          pander(kable(emmeans(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),1,4,5)]), collapse = "+") )), data = b) , rbc_polymorphism[-k][2] )))
          pander(b %>% filter(!is.na(!!cbc_array_q_2010[[j]]) & !is.na(!!age_at_collection_years) & !is.na(!!rbc_polymorphism_q[-k][[2]])) %>% count(!!rbc_polymorphism_q[-k][[2]]))

          ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
          par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
          plot(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),1,4,5)]), collapse = "+") )), data = b))
          cat(' \n \n')
          
          ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
          pander(summary(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),1,3,4,5)]), collapse = "+") )), data = b)),add.significance.stars = T)
          pander(confint(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),1,3,4,5)]), collapse = "+") )), data = b), level=0.95))
          pander(kable(emmeans(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),1,3,4,5)]), collapse = "+") )), data = b) , rbc_polymorphism[-k][2] )))
          pander(b %>% filter(!is.na(!!cbc_array_q_2010[[j]]) & !is.na(!!age_at_collection_years) & !is.na(!!rbc_polymorphism_q[-k][[2]])) %>% count(!!rbc_polymorphism_q[-k][[2]]))

          ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
          par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
          plot(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),1,3,4,5)]), collapse = "+") )), data = b))
          cat(' \n \n')          
           }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
          
          
          
         cat(' \n')
        }
        cat(' \n')
      }
      
    }
  
}
pgd_cbc_vs_rbcpol_wambua(cbc_array= cbc_array_2010, malariapositive= 'malaria_status', age_at_collection_years = 'age_at_collection_years_2010')
```

##Association of g6pd enzyme activity with each polymorphism in all individuals {.tabset}

```{r, echo=F, results='asis', warning=F}
panderOptions('knitr.auto.asis', FALSE) 
panderOptions('table.split.table', Inf)

pgd_g6pdenzyme_vs_rbc_polymorphism_n_age_of_children = function(cbc_array, malariapositive, malariapositive1, age_at_collection_years) {
  for (j in 1:length(ed)) {
    cat('###', ed[j], ' {.tabset}', ' \n')
    for (i in 1:length(rbc_polymorphism)) {
    
      cat('####', rbc_polymorphism[i], '+ malaria +ve', ' \n')

        b = pgd_genopheno_01042018[, c ("g6pd_202_rtpcr", "thal", "sickle" , age_at_collection_years, ed[j], malariapositive, rbc_polymorphism[i], "sex", "ethnic")]
        ##Shapiro to check for normality of ughb and fligner to check for equality of variance
        pander(shapiro.test(b[,ed[j]]),add.significance.stars = T)
        pander(shapiro.test(b[b[,malariapositive]=="no_malaria",ed[j]]),add.significance.stars = T)
        
        pander(fligner.test(b[,ed[j]] ~ b[,rbc_polymorphism[i]]),add.significance.stars = T)
      
        ##comparison of G6PD enzyme activity between different categories of malaria
        pander(kruskal.test(b[,ed[j]] ~ b[,malariapositive]),add.significance.stars = T)
        
        ##Kruskal for comparison of g6pd enzyme levels in malaria negative individuals between all possible groups per rbc polmorphism
        cat("Kruskal walis___________________________________________________________________ \n")
        pander(kruskal.test(b[,ed[j]] ~ b[,rbc_polymorphism[i]]),add.significance.stars = T)
        
        pander(summary(lm(b[,ed[j]] ~ b[,rbc_polymorphism[i]]),add.significance.stars = T))
        pander(confint(lm(b[,ed[j]] ~ b[,rbc_polymorphism[i]]), level=0.95))
        pander(pgd_genopheno_01042018 %>% filter(!is.na(!!ed_q[[j]]) & !is.na(!!rbc_polymorphism_q[[i]])) %>% count(!!rbc_polymorphism_q[[i]]))
        
        pander(summary(lm(as.formula(paste(ed[j], "~",  rbc_polymorphism[i], "+", age_at_collection_years, "+", "ethnic")), data = b),add.significance.stars = T))
        pander(confint(lm(as.formula(paste(ed[j], "~",  rbc_polymorphism[i], "+", age_at_collection_years, "+", "ethnic")), data = b), level=0.95))
        pander(kable(emmeans(lm(as.formula(paste(ed[j], "~",  rbc_polymorphism[i], "+", age_at_collection_years, "+", "ethnic")), data = b) , rbc_polymorphism[i] )))
        
        pander(pgd_genopheno_01042018 %>% filter(!is.na(!!ed_q[[j]]) & !is.na(!!rbc_polymorphism_q[[i]])) %>% count(!!rbc_polymorphism_q[[i]]))
        
    }
 
  
    
  cat('####Univariate association of g6pd enzyme activity with age, sex, malaria \n')
  pander(summary(lm(as.formula(paste(ed[j],"~", age_at_collection_years)), data = b)),add.significance.stars = T)
  pander(confint(lm(as.formula(paste(ed[j],"~", age_at_collection_years)), data = b), level=0.95))
   
  pander(summary(lm(as.formula(paste(ed[j],"~", "sex")), data = b)),add.significance.stars = T)
  pander(confint(lm(as.formula(paste(ed[j],"~", "sex")), data = b), level=0.95))
  pander(pgd_genopheno_01042018 %>% filter(!is.na(!!ed_q[[j]]) & !is.na(sex)) %>% count(sex))
  
  pander(summary(lm(as.formula(paste(ed[j],"~", "ethnic")), data = b)),add.significance.stars = T)
  pander(confint(lm(as.formula(paste(ed[j],"~", "ethnic")), data = b), level=0.95))
  pander(pgd_genopheno_01042018 %>% filter(!is.na(!!ed_q[[j]]) & !is.na(ethnic)) %>% count(ethnic))
  
  pander(summary(lm(as.formula(paste(ed[j],"~", malariapositive)), data = b)),add.significance.stars = T)
  pander(confint(lm(as.formula(paste(ed[j],"~", malariapositive)), data = b), level=0.95))
  pander(pgd_genopheno_01042018 %>% filter(!is.na(!!ed_q[[j]]) & !is.na(!!malariapositive1)) %>% count(UQ(malariapositive1)))

  
cat(' \n \n')

cat('####Association of g6pd enzyme activity with each polymorphism and age (and interactions between them) \n')

##tukeyHSD for comparison of enzyme activity between all groups of rbc polymorphisms
pander(shapiro.test(pgd_genopheno_01042018[,ed[j]]))

pander(kruskal.test(pgd_genopheno_01042018[pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", ed[j]] ~ pgd_genopheno_01042018[pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "sickle"]))

pander(kruskal.test(pgd_genopheno_01042018[pgd_genopheno_01042018[,"thal"] == "NORM" & pgd_genopheno_01042018[,"sickle"] == "HET" & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] != "HOM/HEMI" , ed[j]] ~ pgd_genopheno_01042018[pgd_genopheno_01042018[,"thal"] == "NORM" & pgd_genopheno_01042018[,"sickle"] == "HET" & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] != "HOM/HEMI", "g6pd_202_rtpcr"]))

pander(kruskal.test(pgd_genopheno_01042018[pgd_genopheno_01042018[,"thal"] == "NORM" & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM" , ed[j]] ~ pgd_genopheno_01042018[pgd_genopheno_01042018[,"thal"] == "NORM" & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "NORM", "sickle"]))

pander(kruskal.test(pgd_genopheno_01042018[pgd_genopheno_01042018[,"thal"] == "NORM" & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET" , ed[j]] ~ pgd_genopheno_01042018[pgd_genopheno_01042018[,"thal"] == "NORM" & pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", "sickle"]))
    
  }
cat(' \n \n')

##Association between ughb and g6pd202 acounting for thal, age, mcv
pander(summary(lm(as.formula(paste("u_ghb3", "~", "g6pd_202_rtpcr", "+", "thal", "+", age_at_collection_years, "+", "ethnic", "+","mcv_2010")), data = pgd_genopheno_01042018)),add.significance.stars = T)
pander(confint(lm(as.formula(paste("u_ghb3", "~","g6pd_202_rtpcr", "+", "thal", "+", age_at_collection_years, "+", "ethnic", "+","mcv_2010")), data = pgd_genopheno_01042018), level=0.95))
pander(kable(emmeans(lm(as.formula(paste("u_ghb3", "~", "g6pd_202_rtpcr", "+", "thal", "+", age_at_collection_years, "+", "ethnic",  "+","mcv_2010")), data = pgd_genopheno_01042018) , "g6pd_202_rtpcr" , by = "thal" )))
par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
plot(lm(as.formula(paste("u_ghb3", "~", "g6pd_202_rtpcr", "+", "thal", "+", age_at_collection_years, "+", "ethnic", "+","mcv_2010")), data = pgd_genopheno_01042018))
cat(' \n \n')

##Association between urcc and g6pd202 acounting for thal, age, mcv, and hgb
pander(summary(lm(as.formula(paste("u_rcc", "~", "g6pd_202_rtpcr", "+", "hgb_2010", "+","mcv_2010")), data = pgd_genopheno_01042018)),add.significance.stars = T)
pander(confint(lm(as.formula(paste("u_rcc", "~", "g6pd_202_rtpcr", "+", "hgb_2010", "+","mcv_2010")), data = pgd_genopheno_01042018), level=0.95))
pander(kable(emmeans(lm(as.formula(paste("u_rcc", "~", "g6pd_202_rtpcr", "+", "hgb_2010", "+","mcv_2010")), data = pgd_genopheno_01042018) , "g6pd_202_rtpcr" )))
par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
plot(lm(as.formula(paste("u_rcc", "~", "g6pd_202_rtpcr", "+", "hgb_2010", "+","mcv_2010")), data = pgd_genopheno_01042018))
cat(' \n \n')

}
pgd_g6pdenzyme_vs_rbc_polymorphism_n_age_of_children(malariapositive = "malaria_status", malariapositive1 = quo(malaria_status), age_at_collection_years = "age_at_collection_years_2010")
```


##wambua g6pd activity {.tabset}

```{r, echo=F, results= 'asis', warning=F}
panderOptions('knitr.auto.asis', FALSE) 
panderOptions('table.split.table', Inf)

pgd_cbc_vs_rbcpol_wambua = function(cbc_array, malariapositive, age_at_collection_years, gtype = c("NORM","HET","HOM", "HOM/HEMI")) {

      ##Looping through different rbc polymorphisms to stratify analysis by this
      for (k in 1:length(rbc_polymorphism)){
        cat('###',rbc_polymorphism[k], ' \n')
        
        for (l in 1:length(gtype)){    
          
          for (m in 1:length(ed)) {
            if( ed[m] == "u_rcc"){
            cat('####', ed[m], ' \n')
            b = pgd_genopheno_01042018[pgd_genopheno_01042018[,rbc_polymorphism[k]] == gtype[l], c ( rbc_polymorphism[-k], age_at_collection_years, "sex", "mcv_2010", "hgb_2010", "ethnic", ed[m])]
            
            
            cat(paste( rbc_polymorphism[k], "_", gtype[l], "ENZYME ACTIVITY_______hgb__________ENZYME ACTIVITY________________hgb"))
            cat(' \n')
             tryCatch({
            ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
            pander(summary(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),2,3,4)]), collapse = "+") )), data = b)),add.significance.stars = T)
            pander(confint(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),2,3,4)]), collapse = "+") )), data = b), level=0.95))
            pander(kable(emmeans(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),2,3,4)]), collapse = "+") )), data = b), rbc_polymorphism[-k][1] )))
            pander(b %>% filter(!is.na(!!ed_q[[m]]) & !is.na(hgb_2010) & !is.na(mcv_2010) & !is.na(!!rbc_polymorphism_q[-k][[1]])) %>% count(!!rbc_polymorphism_q[-k][[1]]))

            ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
            par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
            plot(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),2,3,4)]), collapse = "+") )), data = b))
            cat(' \n \n')
             }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
            
            tryCatch({
            ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
            pander(summary(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),1,3,4)]), collapse = "+") )), data = b)),add.significance.stars = T)
            pander(confint(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),1,3,4)]), collapse = "+") )), data = b), level=0.95))
            pander(kable(emmeans(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),1,3,4)]), collapse = "+") )), data = b), rbc_polymorphism[-k][2] )))
            pander(b %>% filter(!is.na(!!ed_q[[m]]) & !is.na(hgb_2010) & !is.na(mcv_2010) & !is.na(!!rbc_polymorphism_q[-k][[2]])) %>% count(!!rbc_polymorphism_q[-k][[2]]))

            ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
            par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
            plot(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),1,3,4)]), collapse = "+") )), data = b))
            
            cat("\n \n END OF ENZYME ACTIVITY_______hgb__________END OF ENZYME ACTIVITY_______________hgb")
            cat(' \n \n')
            
             }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
            }
            else{
            cat('####', ed[m], ' \n')
            b = pgd_genopheno_01042018[ pgd_genopheno_01042018[,rbc_polymorphism[k]] == gtype[l], c ( rbc_polymorphism[-k], age_at_collection_years, "sex","mcv_2010", "hgb_2010", "ethnic", ed[m])]
            
            cat(paste( rbc_polymorphism[k], "_", gtype[l], "ENZYME ACTIVITY_______rcc__________ENZYME ACTIVITY________________rcc"))
            cat(' \n')
             tryCatch({
            ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
            pander(summary(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),2,4,6)]), collapse = "+") )), data = b)),add.significance.stars = T)
            pander(confint(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),2,4,6)]), collapse = "+") )), data = b), level=0.95))
            pander(kable(emmeans(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),2,4,6)]), collapse = "+") )), data = b), rbc_polymorphism[-k][1] )))
            pander(b %>% filter(!is.na(!!ed_q[[m]]) & !is.na(mcv_2010) & !is.na(!!age_at_collection_years) & !is.na(!!rbc_polymorphism_q[-k][[1]])) %>% count(!!rbc_polymorphism_q[-k][[1]]))

            ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
            par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
            plot(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),2,4,6)]), collapse = "+") )), data = b))
            cat(' \n \n')
             }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
            
            tryCatch({
            ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
            pander(summary(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),1,4,6)]), collapse = "+") )), data = b)),add.significance.stars = T)
            pander(confint(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),1,4,6)]), collapse = "+") )), data = b), level=0.95))
            pander(kable(emmeans(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),1,4,6)]), collapse = "+") )), data = b), rbc_polymorphism[-k][2] )))
            pander(b %>% filter(!is.na(!!ed_q[[m]]) & !is.na(mcv_2010) & !is.na(!!age_at_collection_years) & !is.na(!!rbc_polymorphism_q[-k][[2]])) %>% count(!!rbc_polymorphism_q[-k][[2]]))

            ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
            par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
            plot(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),1,4,6)]), collapse = "+") )), data = b))
            cat("\n END OF ENZYME ACTIVITY_______END OF ENZYME ACTIVITY__________END OF ENZYME ACTIVITY_______________END OF ENZYME ACTIVITY")
            cat(' \n \n')
            
             }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
          }
          }
         cat(' \n')
        }
        cat(' \n')
      }
      cat(' \n')
    
  for (z in 1:length(gtype)){    
          b = pgd_genopheno_01042018[ pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == gtype[z], c ("thal", age_at_collection_years, "sex","hgb_2010", "mcv_2010", "rbc_2010", "mchc_2010", "ethnic", "u_ghb3") ]
          cat(paste( "g6pd202", "_", gtype[z], "________________________________________________________________ "))
          cat(' \n')
          
          #for (m in 1:length(ed)) {
           # if( ed[m] == "u_rcc"){
            #cat('####', ed[m], ' \n')
            #b = pgd_genopheno_01042018[ pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == gtype[z], c ( "thal","sickle", age_at_collection_years, "sex","mcv_2010", "hgb_2010",ed[m])]
            
            
            #cat(paste( "g6pd_202_rtpcr", "_", gtype[z], "ENZYME ACTIVITY_______hgb__________ENZYME ACTIVITY________________hgb"))
            #cat(' \n')
             #tryCatch({
            ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
            #pander(summary(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),5)]), collapse = "+") )), data = b)),add.significance.stars = T)
            #pander(confint(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),5)]), collapse = "+") )), data = b), level=0.95))
            #pander(kable(emmeans(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),5)]), collapse = "+") )), data = b), "sickle" )))
            #pander(b %>% filter(!is.na(!!ed_q[[m]]) & !is.na(sex) & !is.na(hgb_2010) & !is.na(!!age_at_collection_years) & !is.na(sickle)) %>% count(sickle))

            ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
            #par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
            #plot(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),1)]), collapse = "+") )), data = b))
            #cat(' \n \n')
            # }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})

            #}
            #else{
            #cat('####', ed[m], ' \n')
            #b = pgd_genopheno_01042018[ pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == gtype[z], c ( "thal","sickle", age_at_collection_years, "sex","mcv_2010", "hgb_2010",ed[m])]
            
            #cat(paste( "g6pd_202_rtpcr", "_", gtype[z], "ENZYME ACTIVITY_______rcc__________ENZYME ACTIVITY________________rcc"))
            #cat(' \n')
            #tryCatch({
            ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
            #pander(summary(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),6)]), collapse = "+") )), data = b)),add.significance.stars = T)
            #pander(confint(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),6)]), collapse = "+") )), data = b), level=0.95))
            #pander(kable(emmeans(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),6)]), collapse = "+") )), data = b), "sickle" )))
            #pander(b %>% filter(!is.na(!!ed_q[[m]]) & !is.na(sex) & !is.na(mcv_2010) & !is.na(!!age_at_collection_years) & !is.na(sickle)) %>% count(sickle))

            ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
            #par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
            #plot(lm(as.formula(paste(ed[m], "~", paste(colnames(b[-c(length(b),1)]), collapse = "+") )), data = b))
            #cat(' \n \n')
             #}, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})

          #}
         #cat(' \n')
        #}
}
}
pgd_cbc_vs_rbcpol_wambua(cbc_array= cbc_array_2010, malariapositive= 'malaria_status', age_at_collection_years = 'age_at_collection_years_2010')
```


##wambua G6PDd heterozygotes; not accounting for sex as G6PDd is x-linked {.tabset}
```{r, echo=F, results= 'asis', warning=F, eval=F}
panderOptions('knitr.auto.asis', FALSE) 
panderOptions('table.split.table', Inf)
pgd_cbc_vs_rbcpol_wambua = function(cbc_array, malariapositive, age_at_collection_years) {
  for (j in 1:length(cbc_array)) {
    cat('###',cbc_array[j], ' \n')
    
    ##HETEROZYGOUS FOR G6PD DEFICIENCY
    
    b = pgd_genopheno_01042018[ pgd_genopheno_01042018[,"g6pd_202_rtpcr"]=='HET', c (rbc_polymorphism[c(2,3)], age_at_collection_years, "ethnic",  cbc_array[j])]
    cat("lm g6pd_202_rtpcr==HET________________________________________________________________ \n")
    ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
    pander(summary(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),2)]), collapse = "+") )), data = b)),add.significance.stars = T)
    pander(confint(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),2)]), collapse = "+") )), data = b), level=0.95))
    pander(kable(emmeans(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),2)]), collapse = "+") )), data = b), rbc_polymorphism[2] )))
    pander(b %>% filter(!is.na(!!cbc_array_q_2010[[j]]) & !is.na(!!age_at_collection_years) & !is.na(thal) ) %>% count(thal))
    
    pander(summary(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),1)]), collapse = "+") )), data = b)),add.significance.stars = T)
    pander(confint(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),1)]), collapse = "+") )), data = b), level=0.95))
    pander(kable(emmeans(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b),1)]), collapse = "+") )), data = b), rbc_polymorphism[3] )))
    pander(b %>% filter(!is.na(!!cbc_array_q_2010[[j]]) & !is.na(!!age_at_collection_years) & !is.na(sickle) ) %>% count(sickle))
    

    
    ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
    par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
    plot(lm(as.formula(paste(cbc_array[j], "~", paste(colnames(b[-c(length(b))]), collapse = "+") )), data = b))
    
    cat(' \n \n')
  }
 
}
pgd_cbc_vs_rbcpol_wambua(cbc_array= cbc_array_2010, malariapositive= 'malaria_status', age_at_collection_years = 'age_at_collection_years_2010')
```

##wambua G6PDd heterozygotes; not accounting for sex as G6PDd is x-linked : G6PD activity 
```{r, echo=F, results= 'asis', warning=F, eval=F}
panderOptions('knitr.auto.asis', FALSE) 
panderOptions('table.split.table', Inf)
pgd_cbc_vs_rbcpol_wambua = function(cbc_array, malariapositive, age_at_collection_years) {

    for (k in 1:length(ed)) {
      if( ed[k] == "u_rcc"){
      cat('###', ed[k], ' \n')
      
      b = pgd_genopheno_01042018[ pgd_genopheno_01042018[,"g6pd_202_rtpcr"]=='HET', c (rbc_polymorphism[c(2,3)], age_at_collection_years, "rbc_2010", "hgb_2010", "ethnic", ed[k])]
      
      cat("lm g6pd_202_rtpcr==HET ENZYME ACTIVITY_______hgb__________ENZYME ACTIVITY________________hgb \n")
      ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
      pander(summary(lm(as.formula(paste(ed[k], "~", paste(colnames(b[-c(length(b),1,4)]), collapse = "+") )), data = b)),add.significance.stars = T)
      pander(confint(lm(as.formula(paste(ed[k], "~", paste(colnames(b[-c(length(b),1,4)]), collapse = "+") )), data = b), level=0.95))
      pander(kable(emmeans(lm(as.formula(paste(ed[k], "~", paste(colnames(b[-c(length(b),1,4)]), collapse = "+") )), data = b), rbc_polymorphism[3] )))
      pander(b %>% filter(!is.na(!!ed_q[[k]]) & !is.na(!!age_at_collection_years) & !is.na(sickle) & !is.na(hgb_2010)) %>% count(sickle))

      ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
      par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
      plot(lm(as.formula(paste(ed[k], "~", paste(colnames(b[-c(length(b),1)]), collapse = "+") )), data = b))
      cat(' \n \n')
      
      ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
      pander(summary(lm(as.formula(paste(ed[k], "~", paste(colnames(b[-c(length(b),2,4)]), collapse = "+") )), data = b)),add.significance.stars = T)
      pander(confint(lm(as.formula(paste(ed[k], "~", paste(colnames(b[-c(length(b),2,4)]), collapse = "+") )), data = b), level=0.95))
      pander(kable(emmeans(lm(as.formula(paste(ed[k], "~", paste(colnames(b[-c(length(b),2,4)]), collapse = "+") )), data = b), rbc_polymorphism[2] )))
      pander(b %>% filter(!is.na(!!ed_q[[k]]) & !is.na(!!age_at_collection_years) & !is.na(thal) & !is.na(hgb_2010)) %>% count(thal))


      ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
      par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
      plot(lm(as.formula(paste(ed[k], "~", paste(colnames(b[-c(length(b),2)]), collapse = "+") )), data = b))
      cat(' \n \n')
      }
      else{
      cat('###', ed[k], ' \n')
      b = pgd_genopheno_01042018[ pgd_genopheno_01042018[,"g6pd_202_rtpcr"]=='HET', c (rbc_polymorphism[c(2,3)], age_at_collection_years, "rbc_2010", "hgb_2010", ed[k])]

      cat("lm g6pd_202_rtpcr==HET    ENZYME ACTIVITY_______rcc__________ENZYME ACTIVITY________________rcc \n")
      ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
      pander(summary(lm(as.formula(paste(ed[k], "~", paste(colnames(b[-c(length(b),1,5)]), collapse = "+") )), data = b)),add.significance.stars = T)
      pander(confint(lm(as.formula(paste(ed[k], "~", paste(colnames(b[-c(length(b),1,5)]), collapse = "+") )), data = b), level=0.95))
      pander(kable(emmeans(lm(as.formula(paste(ed[k], "~", paste(colnames(b[-c(length(b),1,5)]), collapse = "+") )), data = b), rbc_polymorphism[3] )))
      pander(b %>% filter(!is.na(!!ed_q[[k]]) & !is.na(!!age_at_collection_years) & !is.na(sickle) & !is.na(rbc_2010)) %>% count(sickle))

      ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
      par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
      plot(lm(as.formula(paste(ed[k], "~", paste(colnames(b[-c(length(b),1,5)]), collapse = "+") )), data = b))
      cat(' \n \n')
      
      ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
      pander(summary(lm(as.formula(paste(ed[k], "~", paste(colnames(b[-c(length(b),2,5)]), collapse = "+") )), data = b)),add.significance.stars = T)
      pander(confint(lm(as.formula(paste(ed[k], "~", paste(colnames(b[-c(length(b),2,5)]), collapse = "+") )), data = b), level=0.95))
      pander(kable(emmeans(lm(as.formula(paste(ed[k], "~", paste(colnames(b[-c(length(b),2,5)]), collapse = "+") )), data = b), rbc_polymorphism[2] )))
      pander(b %>% filter(!is.na(!!ed_q[[k]]) & !is.na(!!age_at_collection_years) & !is.na(thal) & !is.na(rbc_2010)) %>% count(thal))
      cat("\n lm g6pd_202_rtpcr==HET END OF ENZYME ACTIVITY_______END OF ENZYME ACTIVITY__________END OF ENZYME ACTIVITY_______________END OF ENZYME ACTIVITY \n")

      ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
      par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
      plot(lm(as.formula(paste(ed[k], "~", paste(colnames(b[-c(length(b),2)]), collapse = "+") )), data = b))
      cat(' \n \n')
      }

  }
    cat(' \n \n')

      tryCatch({
          b = pgd_genopheno_01042018[ pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", c ("thal", age_at_collection_years, "hgb_2010", "mcv_2010", "rbc_2010", "mchc_2010", "ethnic", "u_ghb3") ]
          cat(paste( "g6pd202", "_", "HET", "________________________________________________________________ "))
          cat(' \n')
          
          ##ughb vs select predictors that are significant in a univariate model
          pander(summary(lm(as.formula(paste("u_ghb3", "~", "+", "thal", "+", age_at_collection_years, "+", "hgb_2010", "+","mcv_2010", "+", "mchc_2010")), data = b)),add.significance.stars = T)
            pander(confint(lm(as.formula(paste("u_ghb3", "~", "+" , "thal", "+", age_at_collection_years, "+", "hgb_2010", "+","mcv_2010", "+", "mchc_2010")), data = b), level=0.95))
            pander(kable(emmeans(lm(as.formula(paste("u_ghb3", "~", "+", "thal", "+", age_at_collection_years, "+", "hgb_2010", "+","mcv_2010", "+", "mchc_2010")), data = b), "thal" )))
            pander(b %>% filter(!is.na(u_ghb3) & !is.na(!!age_at_collection_years) & !is.na(thal) & !is.na(hgb_2010) & !is.na(mcv_2010) & !is.na(mchc_2010)) %>% count(thal))
        }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
          cat(' \n \n')
          
      for (n in 1:length(ed)) {
            if( ed[n] == "u_rcc"){
            cat('####', ed[n], ' \n')
            b = pgd_genopheno_01042018[ pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", c ( "thal","sickle", age_at_collection_years, "rbc_2010", "hgb_2010",ed[n])]
            
            
            cat(paste( "g6pd_202_rtpcr", "_", "HET", "ENZYME ACTIVITY_______hgb__________ENZYME ACTIVITY________________hgb"))
            cat(' \n')
             tryCatch({
            ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
            pander(summary(lm(as.formula(paste(ed[n], "~", paste(colnames(b[-c(length(b),4)]), collapse = "+") )), data = b)),add.significance.stars = T)
            pander(confint(lm(as.formula(paste(ed[n], "~", paste(colnames(b[-c(length(b),4)]), collapse = "+") )), data = b), level=0.95))
            pander(kable(emmeans(lm(as.formula(paste(ed[n], "~", paste(colnames(b[-c(length(b),4)]), collapse = "+") )), data = b), "sickle" )))
            pander(b %>% filter(!is.na(!!ed_q[[n]]) & !is.na(hgb_2010) & !is.na(!!age_at_collection_years) & !is.na(sickle)) %>% count(sickle))

            ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
            par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
            plot(lm(as.formula(paste(ed[n], "~", paste(colnames(b[-c(length(b),1)]), collapse = "+") )), data = b))
            cat(' \n \n')
             }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
            

            }
            else{
            cat('####', ed[n], ' \n')
            b = pgd_genopheno_01042018[ pgd_genopheno_01042018[,"g6pd_202_rtpcr"] == "HET", c ( "thal","sickle", age_at_collection_years, "rbc_2010", "hgb_2010",ed[n])]
            
            cat(paste( "g6pd_202_rtpcr", "_", "HET", "ENZYME ACTIVITY_______rcc__________ENZYME ACTIVITY________________rcc"))
            cat(' \n')
             tryCatch({
            ##linear regression model testing for significant difference in each of the cbc traits by genotypes of each rbc polymorphism trait
            pander(summary(lm(as.formula(paste(ed[n], "~", paste(colnames(b[-c(length(b),5)]), collapse = "+") )), data = b)),add.significance.stars = T)
            pander(confint(lm(as.formula(paste(ed[n], "~", paste(colnames(b[-c(length(b),5)]), collapse = "+") )), data = b), level=0.95))
            pander(kable(emmeans(lm(as.formula(paste(ed[n], "~", paste(colnames(b[-c(length(b),5)]), collapse = "+") )), data = b), "sickle" )))
            pander(b %>% filter(!is.na(!!ed_q[[n]]) & !is.na(sex) & !is.na(rbc_2010) & !is.na(!!age_at_collection_years) & !is.na(sickle)) %>% count(sickle))

            ##plot to check assumptions of t.tests which underlie the above tests. Ensuring we aren't violating assumptions
            par(mfrow = c(2,2), mar = c(2,3,1.5,0.5))
            plot(lm(as.formula(paste(ed[n], "~", paste(colnames(b[-c(length(b),1)]), collapse = "+") )), data = b))
            cat(' \n \n')
             }, error=function(e){cat("ERROR :",conditionMessage(e), "\n")})
            

          }
         cat(' \n')
        }
}
pgd_cbc_vs_rbcpol_wambua(cbc_array= cbc_array_2010, malariapositive= 'malaria_status', age_at_collection_years = 'age_at_collection_years_2010')
```



#PLOTS

##Association between G6PD enzyme levels and red cell polymorphisms (independently and in combination) {.tabset}   

```{r, echo=F, results= 'asis', warning=T, eval=F}
rbccbc_xlabels = array(c("NORM", "HET", "HOM/HEMI", "????/????", "????/??_", "??_/??_", "AA", "AS", NA), dim = c(3,3))
thal_lab=expression(paste("??"^"3.7", "-thalassaemia"))
rbccbc_x_mainlab = c("G6PD c.202", thal_lab, "HbS")    

g6pd_activity = c("U/RCC", "U/gHb" )

for (h in 1:length(ed)) {
  cat('###', ed[h], ' {.tabset} \n')

    for (i in 1:length(rbc_polymorphism)) {
      cat('####', rbc_polymorphism[i], ' \n')
      for (j in 1:2) {

      #print(ggplot(data = pgd_genopheno_01042018, aes_string(x = rbc_polymorphism[i], y = ed[h])) + geom_dotplot( binaxis='y', stackdir='center', dotsize = 0.1, position_ = "dodge", binwidth = 1.1))
      #print(ggplot(data = pgd_genopheno_01042018, aes_string(x = rbc_polymorphism[i], y = ed[h])) + geom_boxplot())
        
        print(ggplot(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,ed[h]]),], aes_string(x=rbc_polymorphism[i], y=ed[h]))  + geom_boxplot(aes_string( colour = as.name(rev(rbc_polymorphism[-i])[j])), outlier.shape = NA, position = position_dodge(0.8)) + geom_dotplot(aes_string(fill = as.name(rev(rbc_polymorphism[-i])[j])), binaxis = "y", stackdir = "center", dotsize = 0.5, binwidth = 1/60*(max(pgd_genopheno_01042018[,ed[h]], na.rm = T)- min(pgd_genopheno_01042018[,ed[h]], na.rm = T)), position = position_dodge(0.8)) + scale_shape_manual(values = c(15, 16, 17))  + ylab(g6pd_activity[h]) + xlab(rbccbc_x_mainlab[i]) + scale_fill_grey(start = 0.2, end = .6) + scale_x_discrete(labels= c(rbccbc_xlabels[1, i], rbccbc_xlabels[2, i], rbccbc_xlabels[3, i])) + scale_fill_discrete(labels= c(rbccbc_xlabels[1,rev(c(1,2,3)[-i])[j]], rbccbc_xlabels[2,rev(c(1,2,3)[-i])[j]], rbccbc_xlabels[3,rev(c(1,2,3)[-i])[j]])) + theme_bw(base_size = 13)+  theme(axis.text.x = element_text( size = 12), axis.text.y = element_text( size = 12)))
        
        cbc_rbcpol_gg = ggplot(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,rbc_polymorphism[i]]) & !is.na(pgd_genopheno_01042018[,rbc_polymorphism[rbc_polymorphism != paste(rev(rbc_polymorphism[-i])[j]) & rbc_polymorphism != paste(rbc_polymorphism[i])]]) & !is.na(pgd_genopheno_01042018[,rev(rbc_polymorphism[-i])[j]]),], aes_string(rbc_polymorphism[i], ed[h]))
        
        print(cbc_rbcpol_gg + geom_boxplot(aes_string(fill = rev(rbc_polymorphism[-i])[j]), position = position_dodge(0.9)) + scale_fill_manual(values = c("#999999", "#E69F00", "#20a2ee")) + ylab(g6pd_activity[h]) + facet_wrap(rbc_polymorphism[rbc_polymorphism != paste(rev(rbc_polymorphism[-i])[j]) & rbc_polymorphism != paste(rbc_polymorphism[i])]) + scale_x_discrete(labels= c(rbccbc_xlabels[1, i], rbccbc_xlabels[2, i], rbccbc_xlabels[3, i])) + scale_fill_discrete(labels= c(rbccbc_xlabels[1,rev(c(1,2,3)[-i])[j]], rbccbc_xlabels[2,rev(c(1,2,3)[-i])[j]], rbccbc_xlabels[3,rev(c(1,2,3)[-i])[j]])))
        
        print(ggplot(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,rbc_polymorphism[i]]) & !is.na(pgd_genopheno_01042018[,rbc_polymorphism[rbc_polymorphism != paste(rev(rbc_polymorphism[-i])[j]) & rbc_polymorphism != paste(rbc_polymorphism[i])]]) & !is.na(pgd_genopheno_01042018[,rev(rbc_polymorphism[-i])[j]]),], aes_string(rbc_polymorphism[i], ed[h], shape = rev(rbc_polymorphism[-i])[j], size = rev(rbc_polymorphism[-i])[j])) + stat_summary( fun.data = "mean_se"  , position = position_dodge(0.6), geom="pointrange") + scale_shape_manual(values = c(15, 16, 17) ) + scale_size_manual( values=c(0.8,0.8,0.8)) + guides(shape="none", size = "none") + xlab(rbccbc_x_mainlab[i]) + ylab(g6pd_activity[h]) + scale_x_discrete(labels= c(rbccbc_xlabels[1, i], rbccbc_xlabels[2, i], rbccbc_xlabels[3, i])) + scale_fill_discrete(labels= c(rbccbc_xlabels[1,rev(c(1,2,3)[-i])[j]], rbccbc_xlabels[2,rev(c(1,2,3)[-i])[j]], rbccbc_xlabels[3,rev(c(1,2,3)[-i])[j]]))  + theme_bw(base_size = 13)+  theme(axis.text.x = element_text( size = 12), axis.text.y = element_text( size = 12)))
      }
      
        print(ggplot(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,ed[h]]),], aes_string(x=rbc_polymorphism[i], y=ed[h])) + geom_boxplot( outlier.shape = NA, position = position_dodge(0.8)) + geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 0.8, binwidth = 1/60*(max(pgd_genopheno_01042018[,ed[h]], na.rm = T)- min(pgd_genopheno_01042018[,ed[h]], na.rm = T)), position = position_dodge(0.8)) + scale_shape_manual(values = c(15, 16, 17)) + guides(shape="none") + ylab(g6pd_activity[h]) + xlab(rbccbc_x_mainlab[i]) + scale_x_discrete(labels= c(rbccbc_xlabels[1, i], rbccbc_xlabels[2, i], rbccbc_xlabels[3, i])) + theme_bw(base_size = 13)+  theme(axis.text.x = element_text( size = 12), axis.text.y = element_text( size = 12)))
        
      #print(ggplot(data = pgd_genopheno_01042018, aes_string(x = rbc_polymorphism[i], y = ed[h])) + geom_boxplot())
        print(ggplot(pgd_genopheno_01042018, aes(x=age_at_collection_years_2010, y=u_ghb3)) + geom_smooth(model = lm) )
        print(ggscatter(pgd_genopheno_01042018, x = "age_at_collection_years_2010", y = ed[h], ylab = g6pd_activity[h])+ theme_bw(base_size = 13)+  theme(axis.text.x = element_text( size = 12), axis.text.y = element_text( size = 12)))
        print(ggplot(pgd_genopheno_01042018, aes(x=hgb_2010, y=u_ghb3)) + geom_smooth(model = lm) )
        print(ggscatter(pgd_genopheno_01042018, x = "hgb_2010", y = ed[h], ylab = g6pd_activity[h])+ theme_bw(base_size = 13)+  theme(axis.text.x = element_text( size = 12), axis.text.y = element_text( size = 12)))
        print(ggplot(pgd_genopheno_01042018, aes(x=age_at_collection_years_2010, y=hgb_2010)) + geom_smooth(model = lm) )
        print(ggscatter(pgd_genopheno_01042018, x = "age_at_collection_years_2010", y = "hgb_2010", ylab = "Age (years)")+ theme_bw(base_size = 13)+  theme(axis.text.x = element_text( size = 12), axis.text.y = element_text( size = 12)))
        
        print(ggboxplot(pgd_genopheno_01042018, x = "sex", y = ed[h], shape = "sex", add = "jitter", remove = NA, ylab = g6pd_activity[h])+  theme(axis.text.x = element_text( size = 12), axis.text.y = element_text( size = 12)))
        
        print(ggboxplot(pgd_genopheno_01042018, x = "malaria_status" , y = ed[h], shape =  "malaria_status", add = "jitter", remove = NA, ylab = g6pd_activity[h])+ theme_bw(base_size = 13)+  theme(axis.text.x = element_text( size = 12), axis.text.y = element_text( size = 12)))
       
        cat(' \n \n')
  
}
  
}

```


##Association of RBC traits with combinations of red cell polymorphisms (boxplot) {.tabset}

RBC traits (y axis) grouped by rbc polymorphisms (x axis and color categorization) 

```{r, echo=F, results= 'asis', warning=T}
```

```{r, echo=F, results= 'asis', warning=T}
rbccbc_xlabels = array(c("NORM", "HET", "HOM/HEMI", "????/????", "??_/????", "??_/??_", "AA", "AS", NA), dim = c(3,3))
thal_lab=expression(paste("??"^"3.7", "-thalassaemia"))
rbccbc_xlabels = array(c("NORM", "HET", "HOM/HEMI", "NORM", "HET", "HOM", "AA", "AS", NA), dim = c(3,3))
thal_lab=expression(paste("alpha-thalassaemia"))
rbccbc_x_mainlab = c("G6PD c.202", thal_lab, "HbS") 
#stat_sum_df = function(df) {
  #a=c(Gmean(df, conf.level = 0.95)[2], Gmean(df), Gmean(df, conf.level = 0.95)[3])
  #names(a) = c("ymin", "y", "ymax")
  #a
#}
#rbccbc_limits = array(c(c(4.125, 5.25), c(10.3, 11.9), c(31.5, 35.6), c(63, 84), c(20.5, 28.5), c(31, 34), c(12,16.5)), dim = c(1:2))
rbccbc_limits = array(c(4.125, 5.25, 10.3, 11.9, 63, 84,20.5, 28.5, 31, 34,  31.5, 35.6, 12,16.5), dim = c(2,7))
rcc_lab=expression(paste("RCC (X10" ^"9", "/L)"))
rbccbc_ylabels = c(rcc_lab, "HGB (g/dL)", "MCV (fL)", "MCH (pg)", "MCHC (g/dL)", "HCT (%)", "RDW (%)")

box_cbc_traits_over_pol_grpd_by_cbctrt = function(cbc_array){
for (h in 1:length(cbc_array)) {
  cat('###', cbc_array[h], ' \n')
  
      print(ggplot(pgd_genopheno_01042018, aes_string(x="age_at_collection_years_2010", y=cbc_array[h])) + geom_smooth(model = lm) )
      print(ggscatter(pgd_genopheno_01042018, x = "age_at_collection_years_2010", y = cbc_array[h], xlab = "Age (years)")+ theme_bw(base_size = 13)+  theme(axis.text.x = element_text( size = 12), axis.text.y = element_text( size = 12)))
      print(ggboxplot(pgd_genopheno_01042018, x = "sex", y = cbc_array[h], shape = "sex", add = "jitter", remove = NA) +  theme(axis.text.x = element_text( size = 12), axis.text.y = element_text( size = 12)))
      print(ggboxplot(pgd_genopheno_01042018, x = "malaria_status" , y = cbc_array[h], shape =  "malaria_status", add = "jitter", remove = NA)+ theme_bw(base_size = 13)+  theme(axis.text.x = element_text( size = 12), axis.text.y = element_text( size = 12)))

  for (k in 1:length(ed)) {
      print(ggplot(pgd_genopheno_01042018, aes_string(x=ed[k] , y=cbc_array[h])) + geom_smooth(model = lm) )
      print(ggscatter(pgd_genopheno_01042018, x = ed[k], y = cbc_array[h], xlab = ed[k])+ theme_bw(base_size = 13)+  theme(axis.text.x = element_text( size = 12), axis.text.y = element_text( size = 12)))
      
      
      print(ggplot(pgd_genopheno_01042018, aes_string(x="age_at_collection_years_2010", y=cbc_array[h], color = "sex")) + geom_smooth(model = lm) )
      print(ggplot(pgd_genopheno_01042018, aes_string(x=ed[k] , y=cbc_array[h], color = "g6pd_202_rtpcr" )) + geom_smooth(model = lm) )
      
      }
      
  
  for (i in 1:length(rbc_polymorphism)) {
    for (j in 1:2) {
      
      cbc_rbcpol_gg = ggplot(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,rbc_polymorphism[i]]) & !is.na(pgd_genopheno_01042018[,rbc_polymorphism[rbc_polymorphism != paste(rev(rbc_polymorphism[-i])[j]) & rbc_polymorphism != paste(rbc_polymorphism[i])]]) & !is.na(pgd_genopheno_01042018[,rev(rbc_polymorphism[-i])[j]]),], aes_string(rbc_polymorphism[i], cbc_array[h]))      
      
      ##Boxplot with cbc grouped by 2 rbc polymorphisms
      print(cbc_rbcpol_gg + geom_boxplot(aes_string(fill = rev(rbc_polymorphism[-i])[j]), position = position_dodge(0.9)) + scale_fill_manual(values = c("#999999", "#E69F00", "#20a2ee" )))
      print(ggplot(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,rbc_polymorphism[i]]) & !is.na(pgd_genopheno_01042018[,rbc_polymorphism[rbc_polymorphism != paste(rev(rbc_polymorphism[-i])[j]) & rbc_polymorphism != paste(rbc_polymorphism[i])]]) & !is.na(pgd_genopheno_01042018[,rev(rbc_polymorphism[-i])[j]]),], aes_string(rbc_polymorphism[i], cbc_array[h], shape = rev(rbc_polymorphism[-i])[j], size = rev(rbc_polymorphism[-i])[j])) + stat_summary( fun.data = "mean_se"  , position = position_dodge(0.6), geom="pointrange") + scale_shape_manual(values = c(15, 16, 17) ) + scale_size_manual( values=c(0.8,0.8,0.8)) + guides(shape="none", size = "none") + coord_cartesian(ylim = c(rbccbc_limits[1,h], rbccbc_limits[2,h])) + ylab(rbccbc_ylabels[h]) + xlab(rbccbc_x_mainlab[i]) + scale_x_discrete(labels= c(rbccbc_xlabels[1, i], rbccbc_xlabels[2, i], rbccbc_xlabels[3, i])) + scale_fill_discrete(labels= c(rbccbc_xlabels[1,rev(c(1,2,3)[-i])[j]], rbccbc_xlabels[2,rev(c(1,2,3)[-i])[j]], rbccbc_xlabels[3,rev(c(1,2,3)[-i])[j]]))  + theme_bw(base_size = 13)+  theme(axis.text.x = element_text( size = 12), axis.text.y = element_text( size = 12)))

      ##Boxplot with cbc grouped by over 3 rbc polymorphisms
      print(cbc_rbcpol_gg + geom_boxplot(aes_string(fill = rev(rbc_polymorphism[-i])[j]), position = position_dodge(0.9)) + scale_fill_manual(values = c("#999999", "#E69F00", "#20a2ee")) + facet_wrap(rbc_polymorphism[rbc_polymorphism != paste(rev(rbc_polymorphism[-i])[j]) & rbc_polymorphism != paste(rbc_polymorphism[i])]) )
      print(cbc_array[h])
      
      }
    
  }
      #cbc_rbcpol_gg = ggplot(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"g6pd_202_rtpcr"]) & !is.na(pgd_genopheno_01042018[,"thal"]) & !is.na(pgd_genopheno_01042018[,"sickle"]) & !is.na(pgd_genopheno_01042018[, cbc_array[h]]),] , aes_string("g6pd_202_rtpcr", cbc_array[h]))
      #print(cbc_rbcpol_gg + geom_boxplot(aes_string(fill = rev(rbc_polymorphism[-i])[j]), position = position_dodge(0.9)) + scale_fill_manual(values = c("#999999", "#E69F00", "#20a2ee")) + facet_wrap(rbc_polymorphism[rbc_polymorphism != paste(rev(rbc_polymorphism[-i])[j]) & rbc_polymorphism != paste(rbc_polymorphism[i])]))
      
      print(ggerrorplot(pgd_genopheno_01042018[!is.na(pgd_genopheno_01042018[,"g6pd_202_rtpcr"]) & !is.na(pgd_genopheno_01042018[,"thal"]) & !is.na(pgd_genopheno_01042018[,"sickle"]) ,], x = "g6pd_202_rtpcr", y = cbc_array[h],  color = "sickle", palette = "jco", facet.by = "thal", short.panel.labs = FALSE,  desc_stat = "mean_se"))     
cat(' \n \n')
}
}
box_cbc_traits_over_pol_grpd_by_cbctrt(cbc_array = cbc_array_2010)
```